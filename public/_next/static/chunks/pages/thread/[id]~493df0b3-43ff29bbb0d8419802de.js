_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[54],{"/Ugf":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n("rB9j"),n("UxlC");function i(e){return e.replace(/(<\/?.+?\/?>)|\n/g,"")}},JMpY:function(e,t,n){"use strict";n("sMBO");var i,r=n("nKUr"),a=n("lwsE"),s=n.n(a),o=n("W8MJ"),c=n.n(o),l=n("7W2i"),u=n.n(l),d=n("a1gu"),p=n.n(d),h=n("Nsbk"),v=n.n(h),m=n("q1tI"),f=n.n(m),j=n("MCNy"),b=n.n(j),k=n("5f2u"),x=n.n(k),O=n("Bvw4"),y=n("l/UT"),C=n("+Lwc"),D=n("kMSe"),w=n("TSYQ"),g=n.n(w);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return p()(this,n)}}var P=Object(D.c)("thread")(i=Object(D.d)(i=function(e){u()(n,e);var t=N(n);function n(e){var i;return s()(this,n),(i=t.call(this,e)).user=i.props.user||{},i}return c()(n,[{key:"onFollowClick",value:function(){"function"===typeof this.props.onFollowClick&&this.props.onFollowClick()}},{key:"onPrivateLetter",value:function(){"function"===typeof this.props.onPrivateLetter&&this.props.onPrivateLetter()}},{key:"onPersonalPage",value:function(){"function"===typeof this.props.onPersonalPage&&this.props.onPersonalPage()}},{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{className:y.a.container,children:[Object(r.jsx)("div",{className:y.a.header,children:Object(r.jsx)("span",{children:"\u697c\u4e3b"})}),Object(r.jsxs)("div",{className:y.a.info,children:[Object(r.jsxs)("div",{className:y.a.AuthorInfo,children:[Object(r.jsx)("div",{className:y.a.avatar,children:Object(r.jsx)(O.a,{image:this.user.avatarUrl,name:this.user.nickname,circle:!0,userId:this.user.id,platform:"pc",onClick:function(){return e.onPersonalPage()}})}),Object(r.jsxs)("div",{className:y.a.information,children:[Object(r.jsx)("div",{className:y.a.name,onClick:function(){return e.onPersonalPage()},children:this.user.nickname||""}),Object(r.jsxs)("div",{className:y.a.dynamic,children:["\u6d3b\u8dc3\u5728 ",Object(C.a)(this.user.updatedAt)]})]})]}),Object(r.jsxs)("div",{className:y.a.theme,children:[Object(r.jsxs)("div",{className:y.a.themeInfo,children:[Object(r.jsx)("div",{className:y.a.title,children:"\u4e3b\u9898"}),Object(r.jsx)("div",{className:y.a.number,children:this.user.threadCount})]}),Object(r.jsxs)("div",{className:y.a.themeInfo,children:[Object(r.jsx)("div",{className:y.a.title,children:"\u70b9\u8d5e"}),Object(r.jsx)("div",{className:y.a.number,children:this.user.likedCount})]}),Object(r.jsxs)("div",{className:y.a.themeInfo,children:[Object(r.jsx)("div",{className:y.a.title,children:"\u5df2\u5173\u6ce8"}),Object(r.jsx)("div",{className:y.a.number,children:this.user.followCount})]}),Object(r.jsxs)("div",{className:y.a.themeInfo,children:[Object(r.jsx)("div",{className:y.a.title,children:"\u7c89\u4e1d"}),Object(r.jsx)("div",{className:y.a.number,children:this.user.fansCount})]})]})]}),this.props.isShowBtn?Object(r.jsxs)("div",{className:y.a.btn,children:[!this.user.follow&&Object(r.jsx)(x.a,{type:"primary",className:y.a.follow,onClick:function(){return e.onFollowClick()},children:Object(r.jsxs)("div",{className:y.a.btnItem,children:[Object(r.jsx)(b.a,{name:"PlusOutlined",size:"14",className:y.a.btnIcon}),Object(r.jsx)("span",{children:"\u5173\u6ce8"})]})}),1===this.user.follow&&Object(r.jsx)(x.a,{type:"primary",className:g()(y.a.follow,y.a["is-followed"]),onClick:function(){return e.onFollowClick()},children:Object(r.jsxs)("div",{className:y.a.btnItem,children:[Object(r.jsx)(b.a,{name:"CheckOutlined",size:"14",className:y.a.btnIcon}),Object(r.jsx)("span",{children:"\u5df2\u5173\u6ce8"})]})}),2===this.user.follow&&Object(r.jsx)(x.a,{type:"primary",className:g()(y.a.follow,y.a["with-followed"]),onClick:function(){return e.onFollowClick()},children:Object(r.jsxs)("div",{className:y.a.btnItem,children:[Object(r.jsx)(b.a,{name:"WithdrawOutlined",size:"14",className:y.a.btnIcon}),Object(r.jsx)("span",{children:"\u4e92\u5173"})]})}),Object(r.jsx)(x.a,{className:y.a.privateLetter,onClick:function(){return e.onPrivateLetter()},children:Object(r.jsxs)("div",{className:y.a.btnItem,children:[Object(r.jsx)(b.a,{name:"CommentOutlined",size:"14",className:y.a.btnIcon}),Object(r.jsx)("span",{children:"\u53d1\u79c1\u4fe1"})]})})]}):""]})}}]),n}(f.a.Component))||i)||i;t.a=P},L0er:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n("nKUr"),r=n("q1tI"),a=n("no3E"),s=n("5f2u"),o=n.n(s),c=n("z8Av");function l(e){var t=Object(r.useState)(e.text||"\u670d\u52a1\u5668\u9519\u8bef SERVER ERROR")[0];return Object(i.jsxs)("div",{className:a.a.page,children:[Object(i.jsx)(c.a,{}),Object(i.jsxs)("div",{className:a.a.body,children:[Object(i.jsx)("img",{className:a.a.icon,src:"/dzq-img/error.png"}),Object(i.jsx)("span",{className:a.a.text,children:t})]}),Object(i.jsx)("div",{className:a.a.footer,children:Object(i.jsx)(o.a,{onClick:function(){window.location.reload()},className:a.a.button,type:"primary",children:"\u70b9\u6211\u5237\u65b0"})})]})}},"TP+V":function(e,t,n){"use strict";n.r(t);n("ma9I"),n("QWBl"),n("yXV3"),n("oVuX"),n("qePV"),n("rB9j"),n("Rm1S"),n("UxlC"),n("FZtP");var i=n("nKUr"),r=n("o0o1"),a=n.n(r),s=(n("ls82"),n("yXPU")),o=n.n(s),c=n("lwsE"),l=n.n(c),u=n("W8MJ"),d=n.n(u),p=n("7W2i"),h=n.n(p),v=n("a1gu"),m=n.n(v),f=n("Nsbk"),j=n.n(f),b=n("q1tI"),k=n.n(b),x=n("20a2"),O=n("kMSe"),y=n("sho3"),C=(n("TeQF"),n("2B1R"),n("hByQ"),n("R5XZ"),n("lSNA")),D=n.n(C),w=n("B5JU"),g=n.n(w),N=n("B5zU"),P=n("HgT0"),R=(n("ACYA"),n("TSYQ")),I=n.n(R);var S=n("wrmh"),L=n("MCNy"),T=n.n(L),E=n("DetZ"),A=n.n(E),M=n("wdT/"),V=n.n(M),F=n("z8Av"),B=n("IvHc"),W=n("woGs"),z=n("33mu"),U=function(e){var t=e.showContent,n=e.setTop;return Object(i.jsxs)("div",{className:"".concat(z.a.setTop," ").concat(n?z.a.inTop:z.a.outTop),children:[Object(i.jsx)("span",{className:z.a.setTopIcon,children:Object(i.jsx)(T.a,{className:z.a.icon,name:"CheckOutlined"})}),t?"\u7f6e\u9876\u6210\u529f":"\u5df2\u53d6\u6d88\u7f6e\u9876"]})},_=n("aIz1"),q=n("c7hV"),G=n("iVyX"),H=n("dQ0f"),K=n("TibX"),X=n("z6Ap"),J=n("rOX+"),Q=n.n(J),Y=n("fkjL"),Z=n("k8W2"),$=n.n(Z),ee=n("5f2u"),te=n.n(ee),ne=n("x2xJ"),ie=n.n(ne),re=n("/G68"),ae=n("lY1M"),se=function(e){var t=e.visible,n=e.onOkClick,r=Object(b.useState)(""),s=r[0],c=r[1];Object(b.useEffect)((function(){c("")}),[t]);var l=function(){"function"===typeof(null===e||void 0===e?void 0:e.onCancel)&&e.onCancel()},u=function(){var e=o()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(""===s||Number(s)<=0||Number(s)>1e6)){e.next=4;break}return(""===s||Number(s)<=0)&&V.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u4e3a0"}),Number(s)>1e6&&V.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7100\u4e07"}),e.abrupt("return");case 4:if("function"!==typeof n){e.next=16;break}return e.prev=6,e.next=9,n(s);case 9:e.sent&&c(""),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(){return e.apply(this,arguments)}}(),d=function(){ae.b.env("ios")&&setTimeout((function(){return function(){var e=document.body.scrollHeight;window.scrollTo(0,e)}()}),100)};return Object(i.jsx)($.a,{position:"bottom",visible:t,onClose:l,children:Object(i.jsxs)("div",{className:re.a.container,children:[Object(i.jsx)("div",{className:re.a.header,children:"\u652f\u4ed8\u4f5c\u8005\u7ee7\u7eed\u521b\u4f5c"}),Object(i.jsxs)("div",{className:re.a.rewardInput,children:[Object(i.jsx)("span",{className:re.a.prepend,children:"\u652f\u4ed8\u91d1\u989d"}),Object(i.jsx)(A.a,{mode:"number",placeholder:"\u91d1\u989d",className:re.a.input,value:s,onChange:function(e){return function(e){var t=e.match(/([1-9]\d{0,6}|0)(\.\d{0,2})?/);c(t?t[0]:"")}(e.target.value)},onFocus:function(){return d()}}),Object(i.jsx)("span",{className:re.a.append,children:"\u5143"})]}),Object(i.jsx)("div",{className:re.a.rewardList,children:[1,2,5,10,20,50,88,128].map((function(e){return Object(i.jsxs)("div",{onClick:function(){return function(e){c(e)}(e)},className:I()(re.a.reward,Number(s)===e&&re.a.actived),children:["\uffe5",e]},e)}))}),Object(i.jsx)(ie.a,{className:re.a.divider}),Object(i.jsxs)("div",{className:re.a.button,children:[Object(i.jsx)(te.a,{onClick:l,className:re.a.cancel,type:"default",children:"\u53d6\u6d88"}),Object(i.jsx)(te.a,{onClick:u,className:re.a.ok,type:"primary",children:"\u786e\u5b9a"})]})]})})},oe=n("kjBj"),ce=n("RiVy"),le=(n("sMBO"),n("5MUC")),ue=n("RGe9"),de=n("NOng"),pe=n("HLiX"),he=n("Hg/G"),ve=n("JMBi"),me=n("f5Uc"),fe=(n("pNMO"),n("4Brf"),n("07d7"),n("9p2j"),n("zzKd"),Symbol("\u7ea2\u5305"),Symbol("\u8d4f\u91d1"),n("fEx9")),je=n("W7Eq"),be=(n("lW1z"),n("JuNc")),ke=n("zBpv"),xe=n("uYGS"),Oe=n("Bvw4"),ye=n("bJLh"),Ce=n("CVCv"),De=function(e){var t=e.onClose,n=void 0===t?function(){}:t,r=e.money,a=void 0===r?"0.00":r,s=Object(b.useState)(!1),o=s[0],c=s[1],l=Object(b.useRef)(null),u=function(){document.querySelector("#button").style="transform: rotateY(360deg); visibility: hidden",document.querySelector("#open").style.visibility="hidden",document.querySelector("#moneyText").style="opacity: 1",c(!0)};return Object(i.jsxs)("div",{className:Ce.a.masking,onClick:function(e){"function"===typeof n&&o&&n()},ref:l,children:[Object(i.jsxs)("div",{className:Ce.a.container,onClick:function(e){return e.stopPropagation()},children:[Object(i.jsxs)("div",{className:Ce.a.moneyText,id:"moneyText",children:[Object(i.jsx)("div",{className:Ce.a.text,children:"\u606d\u559c\u60a8\uff0c\u9886\u5230\u4e86"}),Object(i.jsxs)("div",{className:Ce.a.money,children:[a,"\u5143"]})]}),Object(i.jsx)("div",{className:Ce.a.button,id:"button",onClick:u,children:Object(i.jsx)("div",{className:Ce.a.open,id:"open",children:"\u5f00"})}),Object(i.jsx)("img",{src:"https://imgcache.qq.com/operation/dianshi/other/up.01d1a47e41389411f01d143867134d93e0678512.png",id:"up",className:I()(Ce.a.up,D()({},Ce.a.animationUp,o))}),Object(i.jsx)("img",{src:"https://imgcache.qq.com/operation/dianshi/other/bottom.5e276e5e63dc355cea9ad803dbc2bc6169acc0ed.gif",id:"bottom",className:I()(Ce.a.bottom,D()({},Ce.a.animationBottom,o))})]}),Object(i.jsx)("div",{className:Ce.a.button,id:"button",onClick:u,children:Object(i.jsx)("div",{className:Ce.a.open,id:"open",children:"\u5f00"})})]})},we=n("4x5+"),ge=n.n(we),Ne=n("e3gm");function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(n),!0).forEach((function(t){D()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ge.a.register(Ne.a);var Ie,Se=Object(x.withRouter)(Object(O.c)("site","user")(Object(O.d)((function(e){var t,n,r,s,c,l,u,d,p,h,v,m,f,j,k,x,O,y,C,D,w,g,N,P,R,S,L,E,A,M,V,F,B,W,z,U,_,q,G,H,X,J,Q,Y,Z,$,ee,ne,ie,re,ae,se,oe,ce,Ce,we,Ne,Pe=e.store,Ie=e.site,Se=(null===Pe||void 0===Pe||null===(t=Pe.threadData)||void 0===t?void 0:t.content)||{},Le=Se.text,Te=Se.indexes,Ee=null===Pe||void 0===Pe?void 0:Pe.threadData,Ae=Ee.parentCategoryName,Me=Ee.categoryName,Ve=Pe.hasRedPacket,Fe={postId:null===Pe||void 0===Pe||null===(n=Pe.threadData)||void 0===n?void 0:n.postId,threadId:null===Pe||void 0===Pe||null===(r=Pe.threadData)||void 0===r?void 0:r.threadId,platform:"h5",payType:null===Pe||void 0===Pe||null===(s=Pe.threadData)||void 0===s?void 0:s.payType},Be=1===((null===Pe||void 0===Pe||null===(c=Pe.threadData)||void 0===c?void 0:c.isApproved)||0),We=(null===Pe||void 0===Pe||null===(l=Pe.threadData)||void 0===l||null===(u=l.displayTag)||void 0===u?void 0:u.isEssence)||!1,ze=0===(null===Pe||void 0===Pe||null===(d=Pe.threadData)||void 0===d?void 0:d.payType),Ue=2===(null===Pe||void 0===Pe||null===(p=Pe.threadData)||void 0===p?void 0:p.payType)&&!1===(null===Pe||void 0===Pe||null===(h=Pe.threadData)||void 0===h?void 0:h.paid),_e=(null===Pe||void 0===Pe||null===(v=Pe.threadData)||void 0===v?void 0:v.attachmentPrice)||0,qe=!$e&&Ue&&!Xe&&!Ke,Ge=1===(null===Pe||void 0===Pe||null===(m=Pe.threadData)||void 0===m?void 0:m.payType),He=(null===Pe||void 0===Pe||null===(f=Pe.threadData)||void 0===f?void 0:f.price)||0,Ke=!0===(null===Pe||void 0===Pe||null===(j=Pe.threadData)||void 0===j?void 0:j.paid),Xe=(1===(null===Pe||void 0===Pe||null===(k=Pe.threadData)||void 0===k?void 0:k.payType)&&(null===Pe||void 0===Pe||null===(x=Pe.threadData)||void 0===x||x.paid),(null===(O=e.user)||void 0===O||null===(y=O.userInfo)||void 0===y?void 0:y.id)&&(null===(C=e.user)||void 0===C||null===(D=C.userInfo)||void 0===D?void 0:D.id)===(null===Pe||void 0===Pe||null===(w=Pe.threadData)||void 0===w?void 0:w.userId)),Je=null===Pe||void 0===Pe||null===(g=Pe.threadData)||void 0===g||null===(N=g.displayTag)||void 0===N?void 0:N.isRedPack,Qe=null===Pe||void 0===Pe||null===(P=Pe.threadData)||void 0===P||null===(R=P.displayTag)||void 0===R?void 0:R.isReward,Ye=ze&&(null===Pe||void 0===Pe||null===(S=Pe.threadData)||void 0===S?void 0:S.ability.canBeReward)&&!Je&&!Qe,Ze=null===Pe||void 0===Pe||null===(L=Pe.threadData)||void 0===L?void 0:L.isReward,$e=null===Pe||void 0===Pe||null===(E=Pe.threadData)||void 0===E?void 0:E.ability.canFreeViewPost,et=Object(le.a)(Te);1===(null===(A=et.RED_PACKET)||void 0===A?void 0:A.condition)&&Pe.getRedPacketInfo(et.RED_PACKET.threadId);var tt=function(){var t=o()(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"function"===typeof e.onPayClick&&e.onPayClick();case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),nt=function(){"function"===typeof e.onRewardClick&&e.onRewardClick()};Object(b.useEffect)((function(){var t;(null===(t=et.IMAGE)||void 0===t?void 0:t.length)!==Pe.contentImgLength&&et.IMAGE||e.setContentImgReady()}),[Pe.contentImgLength]);var it=(null===Pe||void 0===Pe||null===(M=Pe.threadData)||void 0===M?void 0:M.ability)||{},rt=it.canDownloadAttachment,at=it.canViewAttachment,st=it.canViewVideo,ot=((null===Pe||void 0===Pe?void 0:Pe.threadData)||{}).tipList;return Object(i.jsxs)("div",{className:"".concat(ke.a.container),children:[Object(i.jsxs)("div",{className:ke.a.header,children:[Object(i.jsx)("div",{className:ke.a.userInfo,children:Object(i.jsx)(be.a,{name:(null===Pe||void 0===Pe||null===(V=Pe.threadData)||void 0===V||null===(F=V.user)||void 0===F?void 0:F.nickname)||"",avatar:(null===Pe||void 0===Pe||null===(B=Pe.threadData)||void 0===B||null===(W=B.user)||void 0===W?void 0:W.avatar)||"",location:(null===Pe||void 0===Pe||null===(z=Pe.threadData)||void 0===z?void 0:z.position.location)||"",groupName:(null===Pe||void 0===Pe||null===(U=Pe.threadData)||void 0===U||null===(_=U.group)||void 0===_?void 0:_.groupName)||"",view:"".concat(null===Pe||void 0===Pe||null===(q=Pe.threadData)||void 0===q?void 0:q.viewCount)||"",time:"".concat(null===Pe||void 0===Pe||null===(G=Pe.threadData)||void 0===G?void 0:G.diffTime)||"",isEssence:We,isPay:!ze,isReward:Qe,isRed:Je,userId:null===Pe||void 0===Pe||null===(H=Pe.threadData)||void 0===H||null===(X=H.user)||void 0===X?void 0:X.userId,onClick:function(t){"function"===typeof e.onUserClick&&e.onUserClick(t)}})}),(null===e||void 0===e||null===(J=e.user)||void 0===J?void 0:J.isLogin())&&Be&&Object(i.jsx)("div",{className:ke.a.more,onClick:function(){e.fun.moreClick()},children:Object(i.jsx)(T.a,{size:20,color:"#8590A6",name:"MoreVOutlined"})})]}),Object(i.jsxs)("div",{className:ke.a.body,children:[(null===Pe||void 0===Pe||null===(Q=Pe.threadData)||void 0===Q?void 0:Q.title)&&Object(i.jsx)("div",{className:ke.a.title,children:null===Pe||void 0===Pe||null===(Y=Pe.threadData)||void 0===Y?void 0:Y.title}),Le&&Object(i.jsx)(pe.a,{needShowMore:!1,content:Le||""}),et.VIDEO&&Object(i.jsx)(ve.a,{url:et.VIDEO.mediaUrl,coverUrl:et.VIDEO.coverUrl,v_height:et.VIDEO.height||null,v_width:et.VIDEO.width||null,status:et.VIDEO.status,canViewVideo:st}),et.IFRAME&&Object(i.jsx)(xe.a,{content:et.IFRAME.content}),et.IMAGE&&Object(i.jsx)(ue.a,{postLoad:function(){Pe.setContentImgLength()},flat:!0,platform:"h5",imgData:et.IMAGE,isPay:qe,onPay:tt}),(et.RED_PACKET||et.REWARD)&&Object(i.jsxs)("div",{className:ke.a.reward,children:[et.REWARD&&Object(i.jsxs)("div",{className:ke.a.rewardBody,style:{width:"100%"},children:[Object(i.jsx)(ye.a,{type:1,money:et.REWARD.money,remainMoney:et.REWARD.remainMoney}),Object(i.jsxs)("div",{className:ke.a.rewardText,children:[Object(i.jsxs)("div",{className:ke.a.rewardMoney,children:["\u672c\u5e16\u5411\u6240\u6709\u4eba\u60ac\u8d4f",Object(i.jsx)("span",{className:ke.a.rewardNumber,children:et.REWARD.money||0}),"\u5143"]}),Object(i.jsxs)("div",{className:ke.a.rewardTime,children:[et.REWARD.expiredAt,"\u622a\u6b62\u60ac\u8d4f"]})]})]}),et.RED_PACKET&&Object(i.jsxs)("div",{style:{width:"100%"},children:[Object(i.jsx)(ye.a,{number:et.RED_PACKET.number,remainNumber:et.RED_PACKET.remainNumber,condition:et.RED_PACKET.condition}),!!et.RED_PACKET.condition&&Object(i.jsxs)("div",{className:ke.a.redPacketLikeNum,children:["\u8bc4\u8bba\u96c6",et.RED_PACKET.likenum,"\u8d5e\u9886\u7ea2\u5305"]})]})]}),et.GOODS&&Object(i.jsxs)("div",{children:[Object(i.jsx)(he.a,{image:et.GOODS.imagePath,amount:et.GOODS.price,title:et.GOODS.title,className:ke.a.product}),Object(i.jsxs)(te.a,{className:ke.a.buyBtn,type:"danger",onClick:function(){var e;(e=et.GOODS.detailContent)&&window.open(e)},children:[Object(i.jsx)(T.a,{className:ke.a.payIcon,name:"ShoppingCartOutlined",size:20}),Object(i.jsx)("span",{className:ke.a.buyText,children:"\u8d2d\u4e70\u5546\u54c1"})]})]}),et.VOICE&&Object(i.jsx)(de.a,{url:et.VOICE.mediaUrl}),et.VOTE&&Object(i.jsx)(je.a,{attachments:et.VOTE,threadId:null===Pe||void 0===Pe||null===(Z=Pe.threadData)||void 0===Z?void 0:Z.threadId,canDownloadAttachment:rt,canViewAttachment:at}),et.VOTE_THREAD&&Object(i.jsx)(me.a,{voteData:et.VOTE_THREAD,threadId:null===Pe||void 0===Pe||null===($=Pe.threadData)||void 0===$?void 0:$.threadId,page:"detail"}),qe&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:tt,children:Object(i.jsxs)(te.a,{className:ke.a.payButton,type:"primary",children:[Object(i.jsx)(T.a,{className:ke.a.payIcon,name:"GoldCoinOutlined",size:16}),Object(i.jsxs)("p",{children:["\u652f\u4ed8",_e,"\u5143\u67e5\u770b\u9644\u4ef6\u5185\u5bb9"]})]})}),ge.a.injection("plugin_detail","thread_extension_display_hook").map((function(e){var t=e.render,n=e.pluginInfo;return Object(i.jsx)("div",{children:t({site:Re(Re({},Ie),{},{isDetailPage:!0}),renderData:et.plugin})},n.name)})),(Ae||Me)&&Object(i.jsx)("div",{className:ke.a.tag,onClick:function(){"function"===typeof e.onTagClick&&e.onTagClick()},children:Ae?"".concat(Ae,"/").concat(Me):Me}),!$e&&Ge&&!Xe&&!Ke&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:tt,children:Object(i.jsxs)(te.a,{className:ke.a.payButton,type:"primary",children:[Object(i.jsx)(T.a,{className:ke.a.payIcon,name:"GoldCoinOutlined",size:16}),"\u652f\u4ed8",He,"\u5143\u67e5\u770b\u5269\u4f59\u5185\u5bb9"]})}),Object(i.jsx)("div",{className:ke.a.rewardContianer,children:Object(i.jsxs)(te.a,{onClick:nt,className:ke.a.rewardButton,type:"primary",children:[Object(i.jsx)(T.a,{className:ke.a.payIcon,name:"HeartOutlined",size:20}),Object(i.jsx)("span",{className:ke.a.rewardext,children:"\u6253\u8d4f"})]})}),ot&&ot.length>0&&Object(i.jsxs)("div",{className:ke.a.moneyList,children:[Object(i.jsxs)("div",{className:ke.a.top,children:[ot.length,"\u4eba\u6253\u8d4f"]}),Object(i.jsx)("div",{className:ke.a.itemList,children:ot.map((function(t){return Object(i.jsx)("div",{onClick:function(){return e.router.push("/user/".concat(t.userId))},className:ke.a.itemAvatar,children:Object(i.jsx)(Oe.a,{image:t.avatar,name:t.nickname,size:"small"})},t.userId)}))})]})]}),Be&&Object(i.jsxs)("div",{className:ke.a.footer,children:[Object(i.jsxs)("div",{className:ke.a.thumbs,children:[Ge&&Object(i.jsx)(T.a,{className:I()(ke.a.payIcon,Ke&&ke.a.actived),name:"GoldCoinOutlined",size:20}),Ye&&Object(i.jsx)(T.a,{onClick:function(){return!Xe&&nt()},className:I()(ke.a.payIcon,Ze&&ke.a.actived),name:"HeartOutlined",size:20}),Object(i.jsxs)("div",{className:I()(ke.a.liked,(null===Pe||void 0===Pe||null===(ee=Pe.threadData)||void 0===ee?void 0:ee.isLike)&&ke.a.actived),onClick:Object(K.a)((function(){"function"===typeof e.onLikeClick&&e.onLikeClick()}),500),children:[Object(i.jsx)(T.a,{name:"LikeOutlined",size:20}),(null===Pe||void 0===Pe||null===(ne=Pe.threadData)||void 0===ne||null===(ie=ne.likeReward)||void 0===ie?void 0:ie.likePayCount)>0&&Object(i.jsx)("span",{className:ke.a.likedNumber,children:(null===Pe||void 0===Pe||null===(re=Pe.threadData)||void 0===re||null===(ae=re.likeReward)||void 0===ae?void 0:ae.likePayCount)||""})]}),Object(i.jsx)("div",{className:ke.a.likeReward,children:Object(i.jsx)(fe.a,{tipData:Fe,imgs:(null===Pe||void 0===Pe||null===(se=Pe.threadData)||void 0===se||null===(oe=se.likeReward)||void 0===oe?void 0:oe.users)||[],showMore:!0,showCount:5,platform:"h5"})})]}),(null===Pe||void 0===Pe||null===(ce=Pe.threadData)||void 0===ce||null===(Ce=ce.likeReward)||void 0===Ce?void 0:Ce.shareCount)>0&&Object(i.jsxs)("div",{className:ke.a.shareCount,children:[null===Pe||void 0===Pe||null===(we=Pe.threadData)||void 0===we||null===(Ne=we.likeReward)||void 0===Ne?void 0:Ne.shareCount,"\u6b21\u5206\u4eab"]})]}),Ve>0&&Object(i.jsx)(De,{onClose:function(){return Pe.setRedPacket(0)},money:Ve})]})})))),Le=(n("ToJy"),n("7mQc")),Te=n("X3A+"),Ee=n("iJKD");function Ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var r=j()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var Me=Object(O.c)("thread")(Ie=Object(O.c)("comment")(Ie=Object(O.c)("commentPosition")(Ie=Object(O.c)("user")(Ie=Object(O.c)("site")(Ie=Object(O.d)(Ie=function(e){h()(n,e);var t=Ae(n);function n(e){var i;return l()(this,n),(i=t.call(this,e)).onSortClick=o()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!==typeof i.props.sort){e.next=11;break}return e.prev=1,e.next=4,i.props.sort(!i.state.commentSort);case 4:e.sent&&i.setState({commentSort:!i.state.commentSort}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),i.state={showAboptPopup:!1,showCommentInput:!1,commentSort:!0,showDeletePopup:!1,showReplyDeletePopup:!1,inputText:"\u8bf7\u8f93\u5165\u5185\u5bb9"},i.commentData=null,i.replyData=null,i.recordCommentLike={id:null,status:null},i.recordReplyLike={id:null,status:null},i}return d()(n,[{key:"likeClick",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:if(t.id){e.next=6;break}return e.abrupt("return");case 6:if(this.recordCommentLike.id!==t.id&&(this.recordCommentLike.status=null),this.recordCommentLike.status===t.isLiked){e.next=12;break}this.recordCommentLike.status=t.isLiked,this.recordCommentLike.id=t.id,e.next=13;break;case 12:return e.abrupt("return");case 13:return n={id:t.id,isLiked:!t.isLiked},e.next=16,this.props.comment.updateLiked(n,this.props.thread);case 16:i=e.sent,r=i.success,s=i.msg,r&&(this.props.isPositionComment?(this.props.commentPosition.setCommentListDetailField(t.id,"isLiked",n.isLiked),o=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setCommentListDetailField(t.id,"likeCount",o)):(this.props.thread.setCommentListDetailField(t.id,"isLiked",n.isLiked),c=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setCommentListDetailField(t.id,"likeCount",c))),r||V.a.error({content:s});case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replyLikeClick",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}return e.abrupt("return");case 2:if(this.props.user.isLogin()){e.next=6;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 6:if(this.recordReplyLike.id!==t.id&&(this.recordReplyLike.status=null),this.recordReplyLike.status===t.isLiked){e.next=12;break}this.recordReplyLike.status=t.isLiked,this.recordReplyLike.id=t.id,e.next=13;break;case 12:return e.abrupt("return");case 13:return i={id:t.id,isLiked:!t.isLiked},e.next=16,this.props.comment.updateLiked(i);case 16:r=e.sent,s=r.success,o=r.msg,this.props.isPositionComment?(this.props.commentPosition.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),c=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setReplyListDetailField(n.id,t.id,"likeCount",c)):(this.props.thread.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),l=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setReplyListDetailField(n.id,t.id,"likeCount",l)),s||V.a.error({content:o});case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteClick",value:function(){var e=o()(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.commentData=t,this.setState({showDeletePopup:!0});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteComment",value:function(){var e=o()(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.commentData.id){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.props.comment.delete(this.commentData.id,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 4:if(t=e.sent,n=t.success,i=t.msg,this.setState({showDeletePopup:!1}),!n){e.next=11;break}return V.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 11:V.a.error({content:i});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyDeleteClick",value:function(){var e=o()(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.commentData=n,this.replyData=t,this.setState({showReplyDeletePopup:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"replyDeleteComment",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.replyData.id){e.next=2;break}return e.abrupt("return");case 2:return t={},this.replyData&&this.commentData&&(t.replyData=this.replyData,t.commentData=this.commentData),e.next=6,this.props.comment.deleteReplyComment(t,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 6:if(n=e.sent,i=n.success,r=n.msg,this.setState({showReplyDeletePopup:!1}),!i){e.next=13;break}return V.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 13:V.a.error({content:r});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyClick",value:function(e){var t,n;if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});if(this.props.canPublish("reply")){this.commentData=e,this.replyData=null;var i=(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.nickname)||(null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.userName);this.setState({showCommentInput:!0,inputText:i?"\u56de\u590d".concat(i):"\u8bf7\u8f93\u5165\u5185\u5bb9"})}}},{key:"replyReplyClick",value:function(e,t){var n,i;if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});if(this.props.canPublish("reply")){this.commentData=null,this.replyData=e,this.replyData.commentId=t.id;var r=(null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.nickname)||(null===e||void 0===e||null===(i=e.user)||void 0===i?void 0:i.userName);this.setState({showCommentInput:!0,inputText:r?"\u56de\u590d".concat(r):"\u8bf7\u8f93\u5165\u5185\u5bb9"})}}},{key:"createReply",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.length>0&&void 0!==p[0]?p[0]:"",r=p.length>1&&void 0!==p[1]?p[1]:[],i.replace(/\s/g,"")||0!==r.length){e.next=6;break}return V.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 6:if(s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id){e.next=9;break}return e.abrupt("return");case 9:return o={id:s,content:i},this.replyData&&(o.replyId=this.replyData.id,o.isComment=!0,o.commentId=this.replyData.commentId,o.commentPostId=this.replyData.id),this.commentData&&(o.replyId=this.commentData.id,o.isComment=!0,o.commentId=this.commentData.id),null!==r&&void 0!==r&&r.length&&(o.attachments=r.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=15,this.props.comment.createReply(o,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 15:if(c=e.sent,l=c.success,u=c.msg,d=c.isApproved,!l){e.next=23;break}return this.setState({showCommentInput:!1,inputValue:""}),d?V.a.success({content:u}):V.a.warning({content:u}),e.abrupt("return",!0);case 23:V.a.error({content:u});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"editClick",value:function(e){"function"===typeof this.props.onEditClick&&this.props.onEditClick(e)}},{key:"onCommentClick",value:function(e){var t,n,i,r;e.id&&null!==(t=this.props.thread)&&void 0!==t&&null!==(n=t.threadData)&&void 0!==n&&n.id&&this.props.router.push("/thread/comment/".concat(e.id,"?threadId=").concat(null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id))}},{key:"onAboptClick",value:function(e){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.commentData=e,this.setState({showAboptPopup:!0})}},{key:"onAboptOk",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=15;break}return s={postId:null===(n=this.commentData)||void 0===n?void 0:n.id,rewards:t,threadId:null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.threadId},e.next=4,this.props.thread.reward(s);case 4:if(o=e.sent,c=o.success,l=o.msg,!c){e.next=12;break}return this.setState({showAboptPopup:!1}),this.props.thread.fetchThreadDetail(s.threadId),V.a.success({content:"\u60ac\u8d4f".concat(t,"\u5143")}),e.abrupt("return",!0);case 12:V.a.error({content:l}),e.next=16;break;case 15:V.a.info({content:"\u60ac\u8d4f\u91d1\u989d\u4e0d\u80fd\u4e3a0"});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onAboptCancel",value:function(){this.commentData=null,this.setState({showAboptPopup:!1})}},{key:"avatarClick",value:function(e){var t=e.userId;t&&this.props.router.push("/user/".concat(t))}},{key:"replyAvatarClick",value:function(e,t,n){"function"===typeof this.props.replyAvatarClick&&this.props.replyAvatarClick(e,t,n)}},{key:"render",value:function(){var e,t,n,r,a,s,o,c,l,u,d,p,h,v,m=this,f=this.props.thread,j=f.totalCount,k=f.commentList,x=this.props.commentPosition,O=x.commentList,y=x.postId;this.props.isPositionComment&&(k=O||[]);var C=(null===(e=this.props.user)||void 0===e||null===(t=e.userInfo)||void 0===t?void 0:t.id)&&(null===(n=this.props.user)||void 0===n||null===(r=n.userInfo)||void 0===r?void 0:r.id)===(null===(a=this.props.thread)||void 0===a||null===(s=a.threadData)||void 0===s?void 0:s.userId),D=null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c||null===(l=c.displayTag)||void 0===l?void 0:l.isReward,w=((null===(u=this.props.thread)||void 0===u||null===(d=u.threadData)||void 0===d?void 0:d.content)||{}).indexes,g=((null===(p=this.props.thread)||void 0===p?void 0:p.threadData)||"").isAnonymous,N=Object(le.a)(w);return Object(i.jsxs)(b.Fragment,{children:[this.props.showHeader&&Object(i.jsxs)("div",{className:Ee.a.header,children:[Object(i.jsxs)("div",{className:Ee.a.number,children:["\u5171",j,"\u6761\u8bc4\u8bba"]}),Object(i.jsxs)("div",{className:Ee.a.sort,onClick:function(){return m.onSortClick()},children:[Object(i.jsx)(T.a,{className:Ee.a.sortIcon,name:"SortOutlined"}),Object(i.jsx)("span",{className:Ee.a.sortText,children:this.state.commentSort?"\u8bc4\u8bba\u4ece\u65b0\u5230\u65e7":"\u8bc4\u8bba\u4ece\u65e7\u5230\u65b0"})]})]}),Object(i.jsx)("div",{className:Ee.a.body,children:k.map((function(e,t){var n,r,a,s;return Object(i.jsx)("div",{className:"".concat(Ee.a.commentItems," ").concat(t===k.length-1&&Ee.a.isLastOne),ref:e.id===y?m.props.positionRef:null,children:Object(i.jsx)(Le.a,{data:e,likeClick:Object(K.a)((function(){return m.likeClick(e)}),500),avatarClick:function(){return m.avatarClick(e)},replyClick:function(){return m.replyClick(e)},deleteClick:function(){return m.deleteClick(e)},editClick:function(){return m.editClick(e)},replyAvatarClick:function(t,n){return m.replyAvatarClick(t,e,n)},replyLikeClick:Object(K.a)((function(t){return m.replyLikeClick(t,e)}),500),replyReplyClick:function(t){return m.replyReplyClick(t,e)},replyDeleteClick:function(t){return m.replyDeleteClick(t,e)},onCommentClick:function(){return m.onCommentClick(e)},onAboptClick:function(){return m.onAboptClick(e)},isShowOne:!0,isShowAdopt:C&&D&&(null===(n=m.props.thread)||void 0===n||null===(r=n.threadData)||void 0===r?void 0:r.userId)!==e.userId,threadId:null===(a=m.props.thread)||void 0===a||null===(s=a.threadData)||void 0===s?void 0:s.userId,active:e.id===y,isAnonymous:g},e.id)},e.id||t)}))}),Object(i.jsx)(G.a,{visible:this.state.showCommentInput,inputText:this.state.inputText,onClose:function(){return m.setState({showCommentInput:!1})},onSubmit:function(e,t){return m.createReply(e,t)},site:this.props.site}),Object(i.jsx)(_.a,{visible:this.state.showDeletePopup,onClose:function(){return m.setState({showDeletePopup:!1})},onBtnClick:function(){return m.deleteComment()}}),Object(i.jsx)(_.a,{visible:this.state.showReplyDeletePopup,onClose:function(){return m.setState({showReplyDeletePopup:!1})},onBtnClick:function(){return m.replyDeleteComment()}}),(null===N||void 0===N||null===(h=N.REWARD)||void 0===h?void 0:h.money)&&(null===N||void 0===N||null===(v=N.REWARD)||void 0===v?void 0:v.remainMoney)&&Object(i.jsx)(Te.a,{money:Number(N.REWARD.money),remainMoney:Number(N.REWARD.remainMoney),visible:this.state.showAboptPopup,onCancel:function(){return m.onAboptCancel()},onOkClick:function(e){return m.onAboptOk(e)}})]})}}]),n}(k.a.Component))||Ie)||Ie)||Ie)||Ie)||Ie)||Ie;Me.defaultProps={showHeader:!0};var Ve,Fe=Me,Be=n("QcND"),We=n("ni5c"),ze=n("wXCO"),Ue=n("FeKq");function _e(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var r=j()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var qe=Object(O.c)("site")(Ve=Object(O.c)("user")(Ve=Object(O.c)("thread")(Ve=Object(O.c)("commentPosition")(Ve=Object(O.c)("comment")(Ve=Object(O.c)("index")(Ve=Object(O.c)("card")(Ve=Object(O.c)("vlist")(Ve=Object(O.d)(Ve=function(e){h()(n,e);var t=_e(n);function n(e){var i,r,s;return l()(this,n),(s=t.call(this,e)).setContentImgReady=function(){s.setState({contentImgIsReady:!0})},s.onMoreClick=function(){s.setState({showMorePopup:!0})},s.onOperClick=function(e){if(!s.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});if(s.setState({showMorePopup:!1}),"stick"===e&&s.updateStick(),"essence"===e&&s.updateEssence(),"delete"===e&&s.setState({showDeletePopup:!0}),"edit"===e){var t,n,i,r;if(null===(t=s.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n||!n.id)return;s.props.router.push("/thread/post?id=".concat(null===(i=s.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id))}"report"===e&&s.setState({showReportPopup:!0}),"collect"===e&&s.onCollectionClick(),"wxshare"===e&&s.onShareClick(),"copylink"===e&&s.handleH5Share(),"post"===e&&s.createCard()},s.handleClick=function(){s.props.user.isLogin()?s.setState({show:!0}):Object(B.a)({url:"/user/login"})},s.onShareClose=function(){s.setState({show:!1})},s.handleH5Share=o()(a.a.mark((function e(){var t,n,i,r,o,c,l,u,d,p,h,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.a.info({content:"\u590d\u5236\u94fe\u63a5\u6210\u529f"}),s.onShareClose(),c=(null===(t=s.props.thread)||void 0===t?void 0:t.threadData)||{},l=c.title,u=void 0===l?"":l,Q()({title:u,path:"thread/".concat(null===(n=s.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.threadId)}),d=null===(r=s.props.thread)||void 0===r||null===(o=r.threadData)||void 0===o?void 0:o.id,e.next=7,s.props.thread.shareThread(d,s.props.index,s.props.search,s.props.topic);case 7:p=e.sent,h=p.success,v=p.msg,h||V.a.error({content:v});case 11:case"end":return e.stop()}}),e)}))),s.handleWxShare=function(){s.setState({isShowWeiXinShare:!0}),s.onShareClose(),s.onShareClick()},s.createCard=o()(a.a.mark((function e(){var t,n,i,r,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.props.thread.threadData,n=t.id,i=s.props.card,e.next=5,s.props.thread.shareThread(n,s.props.index,s.props.search,s.props.topic);case 5:r=e.sent,o=r.success,c=r.msg,o||V.a.error({content:c}),i.setThreadData(t),g.a.push({url:"/card?threadId=".concat(n)});case 11:case"end":return e.stop()}}),e)}))),s.state={loadWeiXin:!1,isShowWeiXinShare:!1,showReportPopup:!1,showDeletePopup:!1,showCommentInput:!1,showMorePopup:!1,showRewardPopup:!1,isCommentLoading:!1,setTop:!1,showContent:"",show:!1,stateFlag:!(null!==(i=s.props.thread)&&void 0!==i&&i.isPositionToComment),contentImgIsReady:!1},s.perPage=20,s.commentDataSort=!0,s.threadBodyRef=k.a.createRef(),s.commentDataRef=k.a.createRef(),s.position=0,s.nextPosition=0,s.flag=!(null!==(r=s.props.thread)&&void 0!==r&&r.isPositionToComment),s.isFirst=!0,s.comment=null,s.reportContent=["\u5e7f\u544a\u5783\u573e","\u8fdd\u89c4\u5185\u5bb9","\u6076\u610f\u704c\u6c34","\u91cd\u590d\u53d1\u5e16"],s.inputText="\u5176\u4ed6\u7406\u7531...",s.positionRef=k.a.createRef(),s.isPositioned=!1,s}return d()(n,[{key:"handleOnScroll",value:function(){var e,t,n,i,r,a,s,o,c=null===(e=this.threadBodyRef)||void 0===e||null===(t=e.current)||void 0===t?void 0:t.scrollTop,l=null===(n=this.threadBodyRef)||void 0===n||null===(i=n.current)||void 0===i?void 0:i.offsetHeight,u=null===(r=this.threadBodyRef)||void 0===r||null===(a=r.current)||void 0===a?void 0:a.scrollHeight,d=this.props.thread,p=d.isCommentReady,h=d.isNoMore;(this.props.thread.setScrollDistance(c),c+l>=u&&!this.state.isCommentLoading&&p&&!h&&(this.props.thread.setCommentListPage(this.props.thread.page+1),this.loadCommentList()),this.flag)&&(this.nextPosition=(null===(s=this.threadBodyRef)||void 0===s||null===(o=s.current)||void 0===o?void 0:o.scrollTop)||0)}},{key:"componentDidMount",value:function(){this.setState({loadWeiXin:Object(ce.a)()})}},{key:"componentDidUpdate",value:function(){var e,t,n=this;if(this.isFirst){var i=this.props.thread;if(this.state.contentImgIsReady){var r,a,s,o;if(this.isFirst=!1,this.position=(null===(r=this.commentDataRef)||void 0===r||null===(a=r.current)||void 0===a?void 0:a.offsetTop)-50,i.clearContentImgState(),null!==(s=this.props)&&void 0!==s&&null!==(o=s.thread)&&void 0!==o&&o.isPositionToComment)return void setTimeout((function(){var e,t;null===(e=n.threadBodyRef)||void 0===e||null===(t=e.current)||void 0===t||t.scrollTo(0,n.position)}),1e3);this.threadBodyRef.current.scrollTo(0,this.props.thread.scrollDistance)}null!==(e=this.props.commentPosition)&&void 0!==e&&e.postId&&!this.isPositioned&&null!==(t=this.positionRef)&&void 0!==t&&t.current&&(this.isPositioned=!0,setTimeout((function(){n.positionRef.current.scrollIntoView()}),1e3))}}},{key:"componentWillUnmount",value:function(){}},{key:"onMessageClick",value:function(){var e=this.flag?this.position:0;this.flag=!this.flag,this.setState({stateFlag:this.flag}),this.threadBodyRef.current.scrollTo(0,e)}},{key:"onCollectionClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:return r=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:r,isFavorite:!(null!==(i=this.props.thread)&&void 0!==i&&i.isFavorite)},e.next=8,this.props.thread.updateFavorite(s);case 8:if(o=e.sent,c=o.success,l=o.msg,!c){e.next=14;break}return V.a.success({content:s.isFavorite?"\u6536\u85cf\u6210\u529f":"\u53d6\u6d88\u6536\u85cf"}),e.abrupt("return");case 14:V.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCommentList",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.props.thread.isCommentReady,!this.state.isCommentLoading&&i){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),r=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:r,page:this.props.thread.page,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.thread.loadCommentList(s);case 8:if(o=e.sent,c=o.success,l=o.msg,this.setState({isCommentLoading:!1}),!c){e.next=14;break}return e.abrupt("return",!0);case 14:V.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSortChange",value:function(e){return this.commentDataSort=e,this.props.thread.setCommentListPage(1),this.props.commentPosition.reset(),this.loadCommentList()}},{key:"onInputClick",value:function(){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.props.canPublish("reply")&&this.setState({showCommentInput:!0})}},{key:"onReportOk",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n={threadId:this.props.thread.threadData.threadId,type:1,reason:t,userId:this.props.user.userInfo.id},e.next=5,this.props.thread.createReports(n);case 5:if(i=e.sent,r=i.success,s=i.msg,!r){e.next=12;break}return V.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),this.setState({showReportPopup:!1}),e.abrupt("return",!0);case 12:V.a.error({content:s});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setTopState",value:function(e){var t=this;this.setState({showContent:e,setTop:!this.state.setTop}),setTimeout((function(){t.setState({setTop:!t.state.setTop})}),2e3)}},{key:"updateStick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,o={id:s,isStick:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(r=i.threadData)&&void 0!==r&&r.isStick)},e.next=4,this.props.thread.updateStick(o);case 4:if(c=e.sent,l=c.success,u=c.msg,!l){e.next=11;break}return this.setTopState(o.isStick),(null===(d=this.props)||void 0===d||null===(p=d.index)||void 0===p?void 0:p.refreshHomeData)&&this.props.index.refreshHomeData(),e.abrupt("return");case 11:V.a.error({content:u});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEssence",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,isEssence:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(r=i.threadData)&&void 0!==r&&null!==(s=r.displayTag)&&void 0!==s&&s.isEssence)},e.next=4,this.props.thread.updateEssence(c);case 4:if(l=e.sent,u=l.success,d=l.msg,this.props.thread.updateListStore(),!u){e.next=11;break}return V.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),e.abrupt("return");case 11:V.a.error({content:d});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showDeletePopup:!1}),i=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,e.next=4,this.props.thread.delete(i);case 4:if(r=e.sent,s=r.success,o=r.msg,!s){e.next=11;break}return V.a.success({content:"\u5220\u9664\u6210\u529f\uff0c\u5373\u5c06\u8df3\u8f6c\u81f3\u9996\u9875"}),setTimeout((function(){c.props.router.push("/")}),1e3),e.abrupt("return");case 11:V.a.error({content:o});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onBtnClick",value:function(){this.delete(),this.setState({showDeletePopup:!1})}},{key:"onPublishClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:"",n=i.length>1&&void 0!==i[1]?i[1]:[],t.replace(/\s/g,"")||0!==n.length){e.next=6;break}return V.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 6:if(!this.comment){e.next=12;break}return e.next=9,this.updateComment(t,n);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,this.createComment(t,n);case 14:e.t0=e.sent;case 15:return e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o,c,l,u,d,p,h,v,m,f,j;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id,l={id:c,content:t,sort:this.commentDataSort,isNoMore:null===(s=this.props)||void 0===s||null===(o=s.thread)||void 0===o?void 0:o.isNoMore,attachments:[]},null!==n&&void 0!==n&&n.length&&(l.attachments=n.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=5,this.props.comment.createComment(l,this.props.thread);case 5:if(u=e.sent,d=u.success,p=u.msg,h=u.isApproved,v=u.redPacketAmount,!d){e.next=19;break}return this.props.thread.updatePostCount(this.props.thread.totalCount),this.props.thread.updateListStore(),(null===(m=this.props.thread)||void 0===m||null===(f=m.threadData)||void 0===f||null===(j=f.displayTag)||void 0===j?void 0:j.isRedPack)&&this.props.thread.fetchThreadDetail(c),v&&v>0&&this.props.thread.setRedPacket(v),h?V.a.success({content:p}):V.a.warning({content:p}),this.setState({showCommentInput:!1}),e.abrupt("return",!0);case 19:V.a.error({content:p});case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateComment",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c,l,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.comment){e.next=2;break}return e.abrupt("return");case 2:return r=null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.id,s={id:r,postId:this.comment.id,content:t,attachments:[]},e.next=6,this.props.comment.updateComment(s,this.props.thread);case 6:if(o=e.sent,c=o.success,l=o.msg,u=o.isApproved,!c){e.next=14;break}return u?V.a.success({content:l}):V.a.warning({content:l}),this.setState({showCommentInput:!1}),e.abrupt("return",!0);case 14:V.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEditClick",value:function(e){this.comment=e,this.setState({inputValue:e.content,showCommentInput:!0})}},{key:"onClose",value:function(){this.setState({showCommentInput:!1}),this.comment=null}},{key:"onLikeClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:return c=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,l={id:c,pid:null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.postId,isLiked:!(null!==(s=this.props.thread)&&void 0!==s&&null!==(o=s.threadData)&&void 0!==o&&o.isLike)},e.next=8,this.props.thread.updateLiked(l,this.props.index,this.props.user);case 8:u=e.sent,d=u.success,p=u.msg,d||V.a.error({content:p});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onShareClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(ce.a)()){e.next=2;break}return e.abrupt("return");case 2:return this.setState({isShowWeiXinShare:!0}),t=this.props.thread.threadData,n=t.id,e.next=7,this.props.thread.shareThread(n,this.props.index,this.props.search,this.props.topic);case 7:i=e.sent,r=i.success,s=i.msg,r||V.a.error({content:s});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onPayClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:return r=this.props.thread.threadData,e.next=7,Object(Y.a)(r,null===(t=this.props.user)||void 0===t?void 0:t.userInfo);case 7:if(s=e.sent,!s.success||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId){e.next=13;break}return e.next=12,this.props.thread.fetchThreadDetail(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.threadId);case 12:this.props.thread.updateListStore();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onRewardClick",value:function(){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.setState({showRewardPopup:!0})}},{key:"onRewardSubmit",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c,l,u,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(isNaN(Number(t))||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId||null===(r=this.props.thread)||void 0===r||null===(s=r.threadData)||void 0===s||!s.userId){e.next=9;break}return this.setState({showRewardPopup:!1}),l={amount:Number(t),threadId:this.props.thread.threadData.threadId,payeeId:this.props.thread.threadData.userId,title:(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.title)||"\u4e3b\u9898\u6253\u8d4f"},e.next=5,this.props.thread.rewardPay(l,this.props.user);case 5:u=e.sent,d=u.success,p=u.msg,d||V.a.error({content:p});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTagClick",value:function(){var e,t,n=null===(e=this.props.thread)||void 0===e||null===(t=e.threadData)||void 0===t?void 0:t.categoryId;(n||"number"===typeof n)&&this.props.index.refreshHomeData({categoryIds:[n]}),this.props.vlist.resetPosition(),this.props.router.push("/")}},{key:"replyAvatarClick",value:function(e,t,n){if(2===n){var i=e.userId;if(!i)return;this.props.router.push("/user/".concat(i))}if(3===n){var r=e.commentUserId;if(!r)return;this.props.router.push("/user/".concat(r))}}},{key:"onUserClick",value:function(e){var t,n,i=(this.props.thread||{}).threadData;(null===i||void 0===i||null===(t=i.user)||void 0===t?void 0:t.userId)&&this.props.router.push("/user/".concat(null===i||void 0===i||null===(n=i.user)||void 0===n?void 0:n.userId))}},{key:"onLoadMoreClick",value:function(){this.props.commentPosition.page=this.props.commentPosition.page+1,this.loadCommentPositionList()}},{key:"loadCommentPositionList",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.props.commentPosition.isCommentReady,!this.state.isCommentLoading&&s){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,page:(null===(i=this.props)||void 0===i||null===(r=i.commentPosition)||void 0===r?void 0:r.page)||1,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.commentPosition.loadCommentList(c);case 8:if(l=e.sent,u=l.success,d=l.msg,this.setState({isCommentLoading:!1}),!u){e.next=14;break}return e.abrupt("return",!0);case 14:V.a.error({content:d});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n,r,a,s,o,c,l,u,d,p,h,v,m,f,j,k=this,x=this.props.thread,O=x.isReady,y=x.isCommentReady,C=x.isNoMore,w=x.totalCount,g=x.isCommentListError,R={moreClick:this.onMoreClick},L={canEdit:null===x||void 0===x||null===(e=x.threadData)||void 0===e||null===(t=e.ability)||void 0===t?void 0:t.canEdit,canDelete:null===x||void 0===x||null===(n=x.threadData)||void 0===n||null===(r=n.ability)||void 0===r?void 0:r.canDelete,canEssence:null===x||void 0===x||null===(a=x.threadData)||void 0===a||null===(s=a.ability)||void 0===s?void 0:s.canEssence,canStick:null===x||void 0===x||null===(o=x.threadData)||void 0===o||null===(c=o.ability)||void 0===c?void 0:c.canStick,canShare:this.props.user.isLogin(),canWxShare:this.props.user.isLogin()&&Object(ce.a)(),canCollect:this.props.user.isLogin(),isAdmini:null===(l=this.props)||void 0===l||null===(u=l.user)||void 0===u?void 0:u.isAdmini},E={isEssence:null===x||void 0===x||null===(d=x.threadData)||void 0===d||null===(p=d.displayTag)||void 0===p?void 0:p.isEssence,isStick:null===x||void 0===x||null===(h=x.threadData)||void 0===h?void 0:h.isStick,isCollect:null===x||void 0===x?void 0:x.isFavorite},M=1===((null===x||void 0===x||null===(v=x.threadData)||void 0===v?void 0:v.isApproved)||0),V=this.props.commentPosition,B=V.isShowCommentList,z=V.isNoMore;return Object(i.jsxs)("div",{className:N.a.container,children:[Object(i.jsxs)("div",{className:N.a.header,children:[Object(i.jsx)(F.a,{}),O&&!M&&Object(i.jsxs)("div",{className:N.a.examine,children:[Object(i.jsx)(T.a,{className:N.a.tipsIcon,name:"TipsOutlined"}),Object(i.jsx)("span",{className:N.a.tipsText,children:"\u5185\u5bb9\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\u624d\u80fd\u6b63\u5e38\u663e\u793a\uff01"})]})]}),Object(i.jsxs)("div",{className:N.a.body,ref:this.threadBodyRef,onScrollCapture:Object(H.a)((function(){return k.handleOnScroll()}),1e3),children:[Object(i.jsx)(U,{showContent:this.state.showContent,setTop:this.state.setTop}),O?Object(i.jsx)(Se,{store:x,setContentImgReady:this.setContentImgReady,fun:R,onLikeClick:function(){return k.onLikeClick()},onOperClick:function(e){return k.onOperClick(e)},onCollectionClick:function(){return k.onCollectionClick()},onReportClick:function(){return k.onReportClick()},onRewardClick:function(){return k.onRewardClick()},onTagClick:function(){return k.onTagClick()},onPayClick:function(){return k.onPayClick()},onUserClick:function(e){return k.onUserClick(e)}}):Object(i.jsx)(S.a,{type:"init"}),O&&M&&Object(i.jsx)("div",{className:"".concat(N.a.bottom),ref:this.commentDataRef,children:y?Object(i.jsxs)(b.Fragment,{children:[y&&B&&Object(i.jsxs)(b.Fragment,{children:[Object(i.jsx)(Fe,{isPositionComment:!0,router:this.props.router,sort:function(e){return k.onSortChange(e)},replyAvatarClick:function(e,t,n){return k.replyAvatarClick(e,t,n)}}),!z&&Object(i.jsxs)("div",{className:N.a.showMore,onClick:function(){return k.onLoadMoreClick()},children:[Object(i.jsx)("div",{className:N.a.hidePercent,children:"\u5c55\u5f00\u66f4\u591a\u8bc4\u8bba"}),Object(i.jsx)(T.a,{className:N.a.icon,name:"RightOutlined",size:12})]})]}),Object(i.jsx)(Fe,{canPublish:this.props.canPublish,positionRef:this.positionRef,showHeader:!B,router:this.props.router,sort:function(e){return k.onSortChange(e)},onEditClick:function(e){return k.onEditClick(e)},replyAvatarClick:function(e,t,n){return k.replyAvatarClick(e,t,n)}}),Object(i.jsx)(We.a,{noMoreType:"line",isError:g,noMore:C})]}):Object(i.jsx)(S.a,{isError:g,type:"init"})}),Object(i.jsx)(ze.a,{marginTop:0})]}),O&&M&&Object(i.jsx)("div",{className:N.a.footerContainer,children:Object(i.jsxs)("div",{className:N.a.footer,children:[Object(i.jsx)("div",{className:P.a.inputClick,onClick:function(){return k.onInputClick()},children:Object(i.jsx)(A.a,{className:P.a.input,placeholder:"\u5199\u8bc4\u8bba",disabled:!0,prefixIcon:"EditOutlined"})}),Object(i.jsxs)("div",{className:P.a.operate,children:[Object(i.jsxs)("div",{className:P.a.icon,onClick:function(){return k.onMessageClick()},children:[this.state.stateFlag?w>0?Object(i.jsx)("div",{className:I()(P.a.badge,w<10&&P.a.isCricle),children:w>99?"99+":"".concat(w||"0")}):"":Object(i.jsx)("div",{className:P.a.content,children:"\u6b63\u6587"}),Object(i.jsx)(T.a,{size:"20",name:"MessageOutlined"})]}),Object(i.jsx)(T.a,{className:I()(P.a.icon,D()({},P.a.isliked,null===(m=this.props.thread)||void 0===m||null===(f=m.threadData)||void 0===f?void 0:f.isLike)),onClick:Object(K.a)((function(){return k.onLikeClick()}),500),size:"20",name:"LikeOutlined"}),Object(i.jsx)(T.a,{className:I()(P.a.icon,D()({},P.a.isliked,null===(j=this.props.thread)||void 0===j?void 0:j.isFavorite)),onClick:Object(K.a)((function(){return k.onCollectionClick()}),500),size:"20",name:"CollectOutlinedBig"}),Object(i.jsx)(T.a,{onClick:Object(X.a)((function(){return k.handleClick()}),1e3),className:P.a.icon,size:"20",name:"ShareAltOutlined"})]})]})}),Object(i.jsx)(Ue.a,{show:this.state.show,onClose:this.onShareClose,handleH5Share:this.handleH5Share,handleWxShare:this.handleWxShare,createCard:this.createCard}),O&&Object(i.jsxs)(b.Fragment,{children:[Object(i.jsx)(G.a,{visible:this.state.showCommentInput,onClose:function(){return k.onClose()},initValue:this.state.inputValue,onSubmit:function(e,t){return k.onPublishClick(e,t)},site:this.props.site}),Object(i.jsx)(q.a,{permissions:L,statuses:E,visible:this.state.showMorePopup,onClose:function(){return k.setState({showMorePopup:!1})},onSubmit:function(){return k.setState({showMorePopup:!1})},onOperClick:function(e){return k.onOperClick(e)}}),Object(i.jsx)(_.a,{visible:this.state.showDeletePopup,onClose:function(){return k.setState({showDeletePopup:!1})},onBtnClick:function(e){return k.onBtnClick(e)},type:"thread"}),Object(i.jsx)(W.a,{reportContent:this.reportContent,inputText:this.inputText,visible:this.state.showReportPopup,onCancel:function(){return k.setState({showReportPopup:!1})},onOkClick:function(e){return k.onReportOk(e)}}),Object(i.jsx)(se,{visible:this.state.showRewardPopup,onCancel:function(){return k.setState({showRewardPopup:!1})},onOkClick:function(e){return k.onRewardSubmit(e)}}),this.state.loadWeiXin&&Object(i.jsx)(oe.a,{visible:this.state.isShowWeiXinShare,onClose:function(){return k.setState({isShowWeiXinShare:!1})},type:"thread"})]})]})}}]),n}(k.a.Component))||Ve)||Ve)||Ve)||Ve)||Ve)||Ve)||Ve)||Ve)||Ve,Ge=Object(Be.a)(Object(x.withRouter)(qe)),He=n("JMpY"),Ke=n("iUiS"),Xe=n("E2V6"),Je=function(e){var t=e.visible,n=e.onOkClick,r=Object(b.useState)(""),s=r[0],c=r[1];Object(b.useEffect)((function(){c("")}),[t]);var l=function(){"function"===typeof(null===e||void 0===e?void 0:e.onCancel)&&e.onCancel()},u=function(){var e=o()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(""===s||Number(s)<=0||Number(s)>1e6)){e.next=4;break}return(""===s||Number(s)<=0)&&V.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u4e3a0"}),Number(s)>1e6&&V.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7100\u4e07"}),e.abrupt("return");case 4:if("function"!==typeof n){e.next=16;break}return e.prev=6,e.next=9,n(s);case 9:e.sent&&c(""),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)($.a,{position:"center",visible:t,onClose:l,children:Object(i.jsxs)("div",{className:Xe.a.container,children:[Object(i.jsxs)("div",{className:Xe.a.header,children:[Object(i.jsx)("div",{className:Xe.a.headerLeft,children:"\u652f\u4ed8\u4f5c\u8005\u7ee7\u7eed\u521b\u4f5c"}),Object(i.jsx)(T.a,{className:Xe.a.headerIcon,size:14,name:"CloseOutlined",onClick:l})]}),Object(i.jsxs)("div",{className:Xe.a.rewardInput,children:[Object(i.jsx)("span",{className:Xe.a.prepend,children:"\u652f\u4ed8\u91d1\u989d"}),Object(i.jsx)(A.a,{mode:"number",placeholder:"\u91d1\u989d",className:Xe.a.input,value:s,onChange:function(e){return function(e){var t=e.match(/([1-9]\d{0,6}|0)(\.\d{0,2})?/);c(t?t[0]:"")}(e.target.value)}}),Object(i.jsx)("span",{className:Xe.a.append,children:"\u5143"})]}),Object(i.jsx)("div",{className:Xe.a.rewardList,children:[1,2,5,10,20,50,88,128].map((function(e){return Object(i.jsxs)("div",{onClick:function(){return function(e){c(e)}(e)},className:I()(Xe.a.reward,Number(s)===e&&Xe.a.actived),children:["\uffe5",e]},e)}))}),Object(i.jsxs)("div",{className:Xe.a.button,children:[Object(i.jsx)(te.a,{onClick:l,className:Xe.a.cancel,type:"default",children:"\u53d6\u6d88"}),Object(i.jsx)(te.a,{onClick:u,className:Xe.a.ok,type:"primary",children:"\u786e\u5b9a"})]})]})})},Qe=n("INMq"),Ye=n("KimE"),Ze=n("2w7u"),$e=n("cjmN"),et=function(e){var t=e.showContent,n=e.setTop;return Object(i.jsxs)("div",{className:"".concat($e.a.setTop," ").concat(n?$e.a.inTop:$e.a.outTop),children:[Object(i.jsx)("span",{className:$e.a.setTopIcon,children:Object(i.jsx)(T.a,{className:$e.a.icon,name:"CheckOutlined"})}),t?"\u7f6e\u9876\u6210\u529f":"\u5df2\u53d6\u6d88\u7f6e\u9876"]})},tt=n("DT/J"),nt=function(e){var t=e.isShow;return Object(i.jsx)("div",{className:"".concat(tt.a.examine," ").concat(tt.a.setTop," ").concat(t?tt.a.inTop:tt.a.outTop),children:Object(i.jsxs)("div",{className:tt.a.innerTip,children:[Object(i.jsx)(T.a,{className:tt.a.tipsIcon,name:"TipsOutlined"}),Object(i.jsx)("span",{className:tt.a.tipsText,children:"\u5185\u5bb9\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\u624d\u80fd\u6b63\u5e38\u663e\u793a\uff01"})]})})},it=n("Wpw2"),rt=n("7BN5"),at=n("nfQ1"),st=n.n(at),ot=n("wdPI"),ct=n("kBz5");function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(n),!0).forEach((function(t){D()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ge.a.register(Ne.a);var dt,pt=Object(x.withRouter)(Object(O.c)("site","user")(Object(O.d)((function(e){var t,n,r,s,c,l,u,d,p,h,v,m,f,j,b,k,x,O,y,C,D,w,g,N,P,R,S,L,E,A,M,V,F,B,W,z,U,_,q,G,H,X,J,Q,Y,Z,$,ee,ne,re,ae,se,oe,ce,ke,Ce,De,we,Ne,Pe,Re,Ie,Se,Le,Te,Ee,Ae,Me,Ve=e.store,Fe=e.site,Be=(null===Ve||void 0===Ve||null===(t=Ve.threadData)||void 0===t?void 0:t.content)||{},We=Be.text,ze=Be.indexes,Ue=null===Ve||void 0===Ve?void 0:Ve.threadData,_e=Ue.parentCategoryName,qe=Ue.categoryName,Ge=Ve.hasRedPacket,He={postId:null===Ve||void 0===Ve||null===(n=Ve.threadData)||void 0===n?void 0:n.postId,threadId:null===Ve||void 0===Ve||null===(r=Ve.threadData)||void 0===r?void 0:r.threadId,platform:"pc",payType:null===Ve||void 0===Ve||null===(s=Ve.threadData)||void 0===s?void 0:s.payType},Ke=1===((null===Ve||void 0===Ve||null===(c=Ve.threadData)||void 0===c?void 0:c.isApproved)||0),Xe=0===(null===Ve||void 0===Ve||null===(l=Ve.threadData)||void 0===l?void 0:l.payType),Je=(null===Ve||void 0===Ve||null===(u=Ve.threadData)||void 0===u||null===(d=u.displayTag)||void 0===d?void 0:d.isEssence)||!1,Qe=null===Ve||void 0===Ve||null===(p=Ve.threadData)||void 0===p?void 0:p.isStick,Ye=null===Ve||void 0===Ve||null===(h=Ve.threadData)||void 0===h||null===(v=h.ability)||void 0===v?void 0:v.canEdit,Ze=null===Ve||void 0===Ve||null===(m=Ve.threadData)||void 0===m||null===(f=m.ability)||void 0===f?void 0:f.canDelete,$e=null===Ve||void 0===Ve||null===(j=Ve.threadData)||void 0===j||null===(b=j.ability)||void 0===b?void 0:b.canEssence,et=null===Ve||void 0===Ve||null===(k=Ve.threadData)||void 0===k||null===(x=k.ability)||void 0===x?void 0:x.canStick,tt=null===Ve||void 0===Ve||null===(O=Ve.threadData)||void 0===O?void 0:O.ability.canFreeViewPost,nt=2===(null===Ve||void 0===Ve||null===(y=Ve.threadData)||void 0===y?void 0:y.payType)&&!1===(null===Ve||void 0===Ve||null===(C=Ve.threadData)||void 0===C?void 0:C.paid),it=(null===Ve||void 0===Ve||null===(D=Ve.threadData)||void 0===D?void 0:D.attachmentPrice)||0,rt=!tt&&nt&&!pt&&!dt,at=1===(null===Ve||void 0===Ve||null===(w=Ve.threadData)||void 0===w?void 0:w.payType),lt=(null===Ve||void 0===Ve||null===(g=Ve.threadData)||void 0===g?void 0:g.price)||0,dt=!0===(null===Ve||void 0===Ve||null===(N=Ve.threadData)||void 0===N?void 0:N.paid),pt=(null===(P=e.user)||void 0===P||null===(R=P.userInfo)||void 0===R?void 0:R.id)&&(null===(S=e.user)||void 0===S||null===(L=S.userInfo)||void 0===L?void 0:L.id)===(null===Ve||void 0===Ve||null===(E=Ve.threadData)||void 0===E?void 0:E.userId),ht=null===Ve||void 0===Ve||null===(A=Ve.threadData)||void 0===A||null===(M=A.displayTag)||void 0===M?void 0:M.isRedPack,vt=null===Ve||void 0===Ve||null===(V=Ve.threadData)||void 0===V||null===(F=V.displayTag)||void 0===F?void 0:F.isReward,mt=(Xe&&(null===Ve||void 0===Ve||null===(B=Ve.threadData)||void 0===B||B.ability.canBeReward),null===Ve||void 0===Ve||null===(W=Ve.threadData)||void 0===W||W.isReward,Object(le.a)(ze));1===(null===(z=mt.RED_PACKET)||void 0===z?void 0:z.condition)&&Ve.getRedPacketInfo(mt.RED_PACKET.threadId);var ft=function(){var t=o()(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"function"===typeof e.onPayClick&&e.onPayClick();case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),jt=function(e){e&&window.open(e)},bt=function(t){"function"===typeof e.onOperClick&&e.onOperClick(t)},kt=(null===Ve||void 0===Ve||null===(U=Ve.threadData)||void 0===U?void 0:U.ability)||{},xt=kt.canDownloadAttachment,Ot=kt.canViewAttachment,yt=kt.canViewVideo,Ct=((null===Ve||void 0===Ve?void 0:Ve.threadData)||{}).tipList;return Object(i.jsxs)("div",{className:"".concat(ot.a.container),children:[Object(i.jsxs)("div",{className:ot.a.header,children:[Object(i.jsx)("div",{className:ot.a.userInfo,children:Object(i.jsx)(be.a,{name:(null===Ve||void 0===Ve||null===(_=Ve.threadData)||void 0===_||null===(q=_.user)||void 0===q?void 0:q.nickname)||"",avatar:(null===Ve||void 0===Ve||null===(G=Ve.threadData)||void 0===G||null===(H=G.user)||void 0===H?void 0:H.avatar)||"",groupName:(null===Ve||void 0===Ve||null===(X=Ve.threadData)||void 0===X||null===(J=X.group)||void 0===J?void 0:J.groupName)||"",location:(null===Ve||void 0===Ve||null===(Q=Ve.threadData)||void 0===Q?void 0:Q.position.location)||"",view:"".concat(null===Ve||void 0===Ve||null===(Y=Ve.threadData)||void 0===Y?void 0:Y.viewCount)||"",time:"".concat(null===Ve||void 0===Ve||null===(Z=Ve.threadData)||void 0===Z?void 0:Z.diffTime)||"",userId:null===Ve||void 0===Ve||null===($=Ve.threadData)||void 0===$||null===(ee=$.user)||void 0===ee?void 0:ee.userId,isEssence:Je,isPay:!Xe,isReward:vt,isRed:ht,hideInfoPopip:!0,platform:"pc",onClick:function(t){t&&t.stopPropagation(),"function"===typeof e.onUserClick&&e.onUserClick()}})}),(null===e||void 0===e||null===(ne=e.user)||void 0===ne?void 0:ne.isLogin())&&Object(i.jsxs)("div",{className:ot.a.more,children:[(Je||!Xe||vt||ht)&&Object(i.jsx)(ie.a,{mode:"vertical",className:ot.a.moreDivider}),Ke&&(Ye||et||$e||Ze)&&Object(i.jsx)("div",{className:ot.a.iconText,children:Object(i.jsxs)(st.a,{menu:Object(i.jsxs)(st.a.Menu,{children:[Ye&&Object(i.jsx)(st.a.Item,{id:"edit",children:"\u7f16\u8f91"}),et&&Object(i.jsx)(st.a.Item,{id:"stick",children:Qe?"\u53d6\u6d88\u7f6e\u9876":"\u7f6e\u9876"}),$e&&Object(i.jsxs)(st.a.Item,{id:"essence",children:[" ",Je?"\u53d6\u6d88\u7cbe\u534e":"\u7cbe\u534e"]}),Ze&&Object(i.jsx)(st.a.Item,{id:"delete",children:"\u5220\u9664"})]}),placement:"center",hideOnClick:!0,arrow:!1,trigger:"hover",onChange:function(e){return bt(e)},children:[Object(i.jsx)(T.a,{className:ot.a.icon,name:"SettingOutlined"}),Object(i.jsx)("span",{className:ot.a.text,children:"\u7ba1\u7406"})]})}),!(null!==e&&void 0!==e&&null!==(re=e.user)&&void 0!==re&&re.isAdmini)&&Object(i.jsxs)("div",{className:I()(ot.a.iconText,(null===e||void 0===e||null===(ae=e.user)||void 0===ae?void 0:ae.isAdmini)&&ot.a.disabled),onClick:function(){return bt("report")},children:[Object(i.jsx)(T.a,{className:ot.a.icon,name:"WarnOutlinedThick"}),Object(i.jsx)("span",{className:ot.a.text,children:"\u4e3e\u62a5"})]})]})]}),Object(i.jsx)(ie.a,{className:ot.a.divider}),Object(i.jsxs)("div",{className:ot.a.body,children:[(null===Ve||void 0===Ve||null===(se=Ve.threadData)||void 0===se?void 0:se.title)&&Object(i.jsx)("div",{className:ot.a.title,children:null===Ve||void 0===Ve||null===(oe=Ve.threadData)||void 0===oe?void 0:oe.title}),We&&Object(i.jsx)(pe.a,{needShowMore:!1,content:We||"",usePointer:!1}),mt.VIDEO&&Object(i.jsx)(ve.a,{url:mt.VIDEO.mediaUrl,coverUrl:mt.VIDEO.coverUrl,v_width:mt.VIDEO.width||null,v_height:mt.VIDEO.height||null,status:mt.VIDEO.status,canViewVideo:yt}),mt.IFRAME&&Object(i.jsx)(xe.a,{content:mt.IFRAME.content}),mt.IMAGE&&Object(i.jsx)(ue.a,{flat:!0,platform:"pc",isPay:rt,onPay:ft,imgData:mt.IMAGE}),(mt.RED_PACKET||mt.REWARD)&&Object(i.jsxs)("div",{className:ot.a.reward,style:{width:"100%"},children:[mt.REWARD&&Object(i.jsxs)("div",{className:ot.a.rewardBody,style:{width:"100%"},children:[Object(i.jsx)(ye.a,{type:1,money:mt.REWARD.money,remainMoney:mt.REWARD.remainMoney}),Object(i.jsxs)("div",{className:ot.a.rewardMoney,children:["\u672c\u5e16\u5411\u6240\u6709\u4eba\u60ac\u8d4f",Object(i.jsx)("span",{className:ot.a.rewardNumber,children:mt.REWARD.money||0}),"\u5143"]}),Object(i.jsxs)("div",{className:ot.a.rewardTime,children:[mt.REWARD.expiredAt,"\u622a\u6b62\u60ac\u8d4f"]})]}),mt.RED_PACKET&&Object(i.jsxs)("div",{style:{width:"100%"},children:[Object(i.jsx)(ye.a,{number:mt.RED_PACKET.number,remainNumber:mt.RED_PACKET.remainNumber,condition:mt.RED_PACKET.condition}),!!mt.RED_PACKET.condition&&Object(i.jsxs)("div",{className:ot.a.redPacketLikeNum,children:["\u8bc4\u8bba\u96c6",mt.RED_PACKET.likenum,"\u8d5e\u9886\u7ea2\u5305"]})]})]}),mt.GOODS&&Object(i.jsxs)("div",{className:ot.a.goods,children:[Object(i.jsx)(he.a,{image:null===mt||void 0===mt||null===(ce=mt.GOODS)||void 0===ce?void 0:ce.imagePath,amount:null===mt||void 0===mt||null===(ke=mt.GOODS)||void 0===ke?void 0:ke.price,title:null===mt||void 0===mt||null===(Ce=mt.GOODS)||void 0===Ce?void 0:Ce.title,onClick:function(){return jt(mt.GOODS.detailContent)}}),Object(i.jsx)(te.a,{className:ot.a.buyBtn,type:"danger",onClick:function(){return jt(mt.GOODS.detailContent)},children:Object(i.jsxs)("div",{className:ot.a.buyContent,children:[Object(i.jsx)(T.a,{className:ot.a.buyIcon,name:"ShoppingCartOutlined",size:20}),Object(i.jsx)("span",{className:ot.a.buyText,children:"\u8d2d\u4e70\u5546\u54c1"})]})})]}),mt.VOICE&&Object(i.jsx)(de.a,{url:mt.VOICE.mediaUrl}),mt.VOTE&&Object(i.jsx)(je.a,{attachments:mt.VOTE,threadId:null===Ve||void 0===Ve||null===(De=Ve.threadData)||void 0===De?void 0:De.threadId,canViewAttachment:Ot,canDownloadAttachment:xt}),mt.VOTE_THREAD&&Object(i.jsx)(me.a,{voteData:mt.VOTE_THREAD,threadId:null===Ve||void 0===Ve||null===(we=Ve.threadData)||void 0===we?void 0:we.threadId,page:"detail"}),rt&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:ft,children:Object(i.jsx)(te.a,{className:ot.a.payButton,type:"primary",size:"large",children:Object(i.jsxs)("div",{className:ot.a.pay,children:[Object(i.jsx)(T.a,{className:ot.a.payIcon,name:"GoldCoinOutlined",size:18}),"\u652f\u4ed8",it,"\u5143\u67e5\u770b\u9644\u4ef6"]})})}),ge.a.injection("plugin_detail","thread_extension_display_hook").map((function(e){var t=e.render,n=e.pluginInfo;return Object(i.jsx)("div",{children:t({site:ut(ut({},Fe),{},{isDetailPage:!0}),renderData:mt.plugin})},n.name)})),(_e||qe)&&Object(i.jsx)("div",{className:ot.a.tag,onClick:function(){"function"===typeof e.onTagClick&&e.onTagClick()},children:_e?"".concat(_e,"/").concat(qe):qe}),!tt&&at&&!pt&&!dt&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:ft,children:Object(i.jsx)(te.a,{className:ot.a.payButton,type:"primary",size:"large",children:Object(i.jsxs)("div",{className:ot.a.pay,children:[Object(i.jsx)(T.a,{className:ot.a.payIcon,name:"GoldCoinOutlined",size:18}),"\u652f\u4ed8",lt,"\u5143\u67e5\u770b\u5269\u4f59\u5185\u5bb9"]})})}),Object(i.jsx)(te.a,{onClick:function(){"function"===typeof e.onRewardClick&&e.onRewardClick()},className:ot.a.rewardButton,type:"primary",size:"large",children:Object(i.jsxs)("div",{className:ot.a.buttonIconText,children:[Object(i.jsx)(T.a,{className:ot.a.buttonIcon,name:"HeartOutlined",size:19}),Object(i.jsx)("span",{className:ot.a.buttonText,children:"\u6253\u8d4f"})]})}),Ct&&Ct.length>0&&Object(i.jsxs)("div",{className:ot.a.moneyList,children:[Object(i.jsxs)("div",{className:ot.a.top,children:[Ct.length,"\u4eba\u6253\u8d4f"]}),Object(i.jsx)("div",{className:ot.a.itemList,children:Ct.map((function(t){return Object(i.jsx)("div",{onClick:function(){return e.router.push("/user/".concat(t.userId))},className:ot.a.itemAvatar,children:Object(i.jsx)(Oe.a,{image:t.avatar,name:t.nickname,size:"small"})},t.userId)}))})]})]}),Object(i.jsxs)("div",{className:ot.a.footer,children:[Object(i.jsxs)("div",{className:ot.a.thumbs,children:[Object(i.jsx)("div",{className:ot.a.likeReward,children:Object(i.jsx)(fe.a,{tipData:He,imgs:(null===Ve||void 0===Ve||null===(Ne=Ve.threadData)||void 0===Ne||null===(Pe=Ne.likeReward)||void 0===Pe?void 0:Pe.users)||[],showCount:10,platform:"pc"})}),Object(i.jsx)("span",{children:(null===Ve||void 0===Ve||null===(Re=Ve.threadData)||void 0===Re||null===(Ie=Re.likeReward)||void 0===Ie?void 0:Ie.likePayCount)||""})]}),(null===Ve||void 0===Ve||null===(Se=Ve.threadData)||void 0===Se||null===(Le=Se.likeReward)||void 0===Le?void 0:Le.shareCount)>0&&Object(i.jsxs)("span",{className:ot.a.share,children:[null===Ve||void 0===Ve||null===(Te=Ve.threadData)||void 0===Te||null===(Ee=Te.likeReward)||void 0===Ee?void 0:Ee.shareCount,"\u6b21\u5206\u4eab"]})]}),Object(i.jsx)(ie.a,{className:ot.a.divider}),Ke&&Object(i.jsxs)("div",{className:ot.a.bottomOperate,children:[Object(i.jsxs)("div",{className:I()(ot.a.item,(null===Ve||void 0===Ve||null===(Ae=Ve.threadData)||void 0===Ae?void 0:Ae.isLike)&&ot.a.active),onClick:Object(K.a)((function(){"function"===typeof e.onLikeClick&&e.onLikeClick()}),500),children:[Object(i.jsx)(T.a,{name:"LikeOutlined"}),Object(i.jsx)("span",{children:"\u8d5e"})]}),Object(i.jsxs)("div",{className:I()(ot.a.item,(null===Ve||void 0===Ve||null===(Me=Ve.threadData)||void 0===Me?void 0:Me.isFavorite)&&ot.a.active),onClick:Object(K.a)((function(){"function"===typeof e.onCollectionClick&&e.onCollectionClick()}),500),children:[Object(i.jsx)(T.a,{name:"CollectOutlined"}),Object(i.jsx)("span",{children:"\u6536\u85cf"})]}),Object(i.jsxs)("div",{className:I()(ot.a.item),onClick:Object(K.a)((function(){"function"===typeof e.onShareClick&&e.onShareClick()}),500),children:[Object(i.jsx)(T.a,{name:"ShareAltOutlined"}),Object(i.jsx)("span",{children:"\u5206\u4eab"})]})]}),Ge>0&&Object(i.jsx)(ct.a,{onClose:function(){return Ve.setRedPacket(0)},money:Ge})]})})))),ht=(n("T63A"),n("tkto"),n("J4zp")),vt=n.n(ht),mt=n("TciF"),ft=n("/c/8"),jt=n("PuBq");function bt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var r=j()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var kt={101:"IMAGE",102:"VOICE",103:"VIDEO",104:"GOODS",105:"QA",106:"RED_PACKET",107:"REWARD",108:"VOTE",109:"QUEUE",110:"FILE",111:"QA_IMAGE"},xt=Object(O.c)("thread")(dt=Object(O.c)("comment")(dt=Object(O.c)("commentPosition")(dt=Object(O.c)("user")(dt=Object(O.d)(dt=function(e){h()(n,e);var t=bt(n);function n(e){var i;return l()(this,n),(i=t.call(this,e)).onSortClick=function(){i.setState({commentSort:!i.state.commentSort}),"function"===typeof i.props.sort&&i.props.sort(!i.state.commentSort)},i.state={showAboptPopup:!1,showCommentInput:!1,commentSort:!0,showDeletePopup:!1,showReplyDeletePopup:!1,placeholder:"\u5199\u4e0b\u6211\u7684\u8bc4\u8bba...",commentId:null},i.comment10Ref=k.a.createRef(),i.commentData=null,i.replyData=null,i}return d()(n,[{key:"componentDidMount",value:function(){var e,t;null!==(e=this.props)&&void 0!==e&&null!==(t=e.thread)&&void 0!==t&&t.isPositionToComment&&this.comment10Ref.current&&this.comment10Ref.current.scrollIntoView()}},{key:"likeClick",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:if(t.id){e.next=6;break}return e.abrupt("return");case 6:return n={id:t.id,isLiked:!t.isLiked},e.next=9,this.props.comment.updateLiked(n,this.props.thread);case 9:i=e.sent,r=i.success,s=i.msg,r&&(this.props.isPositionComment?(this.props.commentPosition.setCommentListDetailField(t.id,"isLiked",n.isLiked),o=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setCommentListDetailField(t.id,"likeCount",o)):(this.props.thread.setCommentListDetailField(t.id,"isLiked",n.isLiked),c=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setCommentListDetailField(t.id,"likeCount",c))),r||V.a.error({content:s});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replyLikeClick",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:if(t.id){e.next=6;break}return e.abrupt("return");case 6:return i={id:t.id,isLiked:!t.isLiked},e.next=9,this.props.comment.updateLiked(i);case 9:r=e.sent,s=r.success,o=r.msg,s&&(this.props.isPositionComment?(this.props.commentPosition.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),c=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setReplyListDetailField(n.id,t.id,"likeCount",c)):(this.props.thread.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),l=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setReplyListDetailField(n.id,t.id,"likeCount",l))),s||V.a.error({content:o});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteClick",value:function(){var e=o()(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:this.commentData=t,this.setState({showDeletePopup:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteComment",value:function(){var e=o()(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:if(this.commentData.id){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this.props.comment.delete(this.commentData.id,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 8:if(t=e.sent,n=t.success,i=t.msg,this.setState({showDeletePopup:!1}),!n){e.next=15;break}return V.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 15:V.a.error({content:i});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyDeleteClick",value:function(){var e=o()(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.commentData=n,this.replyData=t,this.setState({showReplyDeletePopup:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"replyDeleteComment",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.replyData.id){e.next=2;break}return e.abrupt("return");case 2:return t={},this.replyData&&this.commentData&&(t.replyData=this.replyData,t.commentData=this.commentData),e.next=6,this.props.comment.deleteReplyComment(t,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 6:if(n=e.sent,i=n.success,r=n.msg,this.setState({showReplyDeletePopup:!1}),!i){e.next=13;break}return V.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 13:V.a.error({content:r});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyClick",value:function(e){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.props.canPublish("reply")&&(this.commentData=e,this.replyData=null,this.setState({showCommentInput:!0,commentId:e.id}))}},{key:"replyReplyClick",value:function(e,t){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.props.canPublish("reply")&&(this.commentData=null,this.replyData=e,this.replyData.commentId=t.id,this.setState({showCommentInput:!0,commentId:null}))}},{key:"createReply",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.length>0&&void 0!==p[0]?p[0]:"",r=p.length>1&&void 0!==p[1]?p[1]:[],i.replace(/\s/g,"")||0!==r.length){e.next=6;break}return V.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 6:if(s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id){e.next=9;break}return e.abrupt("return");case 9:return o={id:s,content:i},this.replyData&&(o.replyId=this.replyData.id,o.isComment=!0,o.commentId=this.replyData.commentId,o.commentPostId=this.replyData.id),this.commentData&&(o.replyId=this.commentData.id,o.isComment=!0,o.commentId=this.commentData.id),null!==r&&void 0!==r&&r.length&&(o.attachments=r.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=15,this.props.comment.createReply(o,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 15:if(c=e.sent,l=c.success,u=c.msg,d=c.isApproved,!l){e.next=23;break}return this.setState({showCommentInput:!1,inputValue:"",commentId:null}),d?V.a.success({content:u}):V.a.warning({content:u}),e.abrupt("return",!0);case 23:V.a.error({content:u});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"editClick",value:function(e){"function"===typeof this.props.onEditClick&&this.props.onEditClick(e)}},{key:"onCommentClick",value:function(e){var t,n,i,r;e.id&&null!==(t=this.props.thread)&&void 0!==t&&null!==(n=t.threadData)&&void 0!==n&&n.id&&this.props.router.push("/thread/comment/".concat(e.id,"?threadId=").concat(null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id))}},{key:"onAboptClick",value:function(e){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.commentData=e,this.setState({showAboptPopup:!0})}},{key:"onAboptOk",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=15;break}return r={postId:this.commentData.id,rewards:t,threadId:null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.threadId},e.next=4,this.props.thread.reward(r);case 4:if(s=e.sent,o=s.success,c=s.msg,!o){e.next=12;break}return this.setState({showAboptPopup:!1}),this.props.thread.fetchThreadDetail(r.threadId),V.a.success({content:"\u60ac\u8d4f".concat(t,"\u5143")}),e.abrupt("return",!0);case 12:V.a.error({content:c}),e.next=16;break;case 15:V.a.info({content:"\u60ac\u8d4f\u91d1\u989d\u4e0d\u80fd\u4e3a0"});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onAboptCancel",value:function(){this.commentData=null,this.setState({showAboptPopup:!1})}},{key:"onUserClick",value:function(e){e&&g.a.push({url:"/user/".concat(e)})}},{key:"reportClick",value:function(e){"function"===typeof this.props.onReportClick&&this.props.onReportClick(e)}},{key:"replyAvatarClick",value:function(e,t,n){if(2===n){var i=e.userId;if(!i)return;this.props.router.push("/user/".concat(i))}if(3===n){var r=e.commentUserId;if(!r)return;this.props.router.push("/user/".concat(r))}}},{key:"onFocus",value:function(e){return this.props.user.isLogin()?!!this.props.canPublish("reply")||void 0:(e&&e.stopPropagation(),V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"}))}},{key:"render",value:function(){var e,t,n,r,a,s,o,c,l,u,d,p,h,v,m=this,f=this.props.thread,j=f.totalCount,b=f.commentList,k=this.props.commentPosition,x=k.commentList,O=k.postId;this.props.isPositionComment&&(b=x||[]);var y=(null===(e=this.props.user)||void 0===e||null===(t=e.userInfo)||void 0===t?void 0:t.id)&&(null===(n=this.props.user)||void 0===n||null===(r=n.userInfo)||void 0===r?void 0:r.id)===(null===(a=this.props.thread)||void 0===a||null===(s=a.threadData)||void 0===s?void 0:s.userId),C=null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c||null===(l=c.displayTag)||void 0===l?void 0:l.isReward,D=((null===(u=this.props.thread)||void 0===u?void 0:u.threadData)||"").isAnonymous,w=((null===(d=this.props.thread)||void 0===d||null===(p=d.threadData)||void 0===p?void 0:p.content)||{}).indexes,g={};return w&&Object.keys(w)&&Object.entries(w).forEach((function(e){var t=vt()(e,2)[1];if(t){var n=t.tomId,i=t.body;g[kt[n]]=i}})),Object(i.jsxs)("div",{className:I()(mt.a.container,!j&&mt.a.isEmpty),children:[this.props.showHeader&&Object(i.jsxs)("div",{className:mt.a.header,children:[j?Object(i.jsxs)("div",{className:mt.a.number,children:[j,"\u6761\u8bc4\u8bba"]}):Object(i.jsx)("div",{className:mt.a.number,children:"\u6682\u65e0\u8bc4\u8bba"}),Object(i.jsxs)("div",{className:mt.a.sort,onClick:function(){return m.onSortClick()},children:[Object(i.jsx)(T.a,{className:mt.a.sortIcon,name:"SortOutlined",size:14}),Object(i.jsx)("span",{className:mt.a.sortText,children:this.state.commentSort?"\u8bc4\u8bba\u4ece\u65b0\u5230\u65e7":"\u8bc4\u8bba\u4ece\u65e7\u5230\u65b0"})]})]}),this.props.showHeader&&Object(i.jsx)("div",{className:mt.a.input,children:Object(i.jsx)(Ke.a,{height:"middle",onSubmit:function(e,t){return m.props.onPublishClick(e,t)},initValue:this.state.inputValue,placeholder:this.state.placeholder,onFocus:function(e){return m.onFocus(e)},onEmojiIconClick:function(){return m.onFocus()},onAtIconClick:function(){return m.onFocus()},onPcitureIconClick:function(){return m.onFocus()}})}),Object(i.jsx)("div",{className:mt.a.body,children:b.map((function(e,t){var n,r;return Object(i.jsx)("div",{className:"".concat(mt.a.commentItems," ").concat(t===b.length-1&&mt.a.isLastOne),ref:e.id===O?m.props.positionRef:null,children:Object(i.jsx)("div",{ref:10===t?m.comment10Ref:null,children:Object(i.jsx)(jt.a,{data:e,avatarClick:function(e){return m.onUserClick(e)},replyAvatarClick:function(t,n){return m.replyAvatarClick(t,e,n)},likeClick:function(){return m.likeClick(e)},replyClick:function(){return m.replyClick(e)},deleteClick:function(){return m.deleteClick(e)},editClick:function(){return m.editClick(e)},replyLikeClick:function(t){return m.replyLikeClick(t,e)},replyReplyClick:function(t){return m.replyReplyClick(t,e)},replyDeleteClick:function(t){return m.replyDeleteClick(t,e)},reportClick:function(){return m.reportClick(e)},onCommentClick:function(){return m.onCommentClick(e)},onSubmit:function(e,t){return m.createReply(e,t)},isShowOne:!0,isShowInput:m.state.commentId===e.id,onAboptClick:function(){return m.onAboptClick(e)},isShowAdopt:y&&C&&(null===(n=m.props.thread)||void 0===n||null===(r=n.threadData)||void 0===r?void 0:r.userId)!==e.userId,threadId:m.props.thread.threadData.userId,active:e.id===O,isAnonymous:D},e.id)})},e.id||t)}))}),Object(i.jsx)(_.a,{visible:this.state.showDeletePopup,onClose:function(){return m.setState({showDeletePopup:!1})},onBtnClick:function(){return m.deleteComment()}}),Object(i.jsx)(_.a,{visible:this.state.showReplyDeletePopup,onClose:function(){return m.setState({showReplyDeletePopup:!1})},onBtnClick:function(){return m.replyDeleteComment()}}),(null===g||void 0===g||null===(h=g.REWARD)||void 0===h?void 0:h.money)&&(null===g||void 0===g||null===(v=g.REWARD)||void 0===v?void 0:v.remainMoney)&&Object(i.jsx)(ft.a,{money:Number(g.REWARD.money),remainMoney:Number(g.REWARD.remainMoney),visible:this.state.showAboptPopup,onCancel:function(){return m.onAboptCancel()},onOkClick:function(e){return m.onAboptOk(e)}})]})}}]),n}(k.a.Component))||dt)||dt)||dt)||dt)||dt;xt.defaultProps={showHeader:!0};var Ot,yt=xt;function Ct(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var r=j()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var Dt,wt=Object(O.c)("site")(Ot=Object(O.c)("user")(Ot=Object(O.c)("thread")(Ot=Object(O.c)("commentPosition")(Ot=Object(O.c)("comment")(Ot=Object(O.c)("index")(Ot=Object(O.d)(Ot=function(e){h()(n,e);var t=Ct(n);function n(e){var i;return l()(this,n),(i=t.call(this,e)).state={showReportPopup:!1,showDeletePopup:!1,showCommentInput:!1,showMorePopup:!1,showRewardPopup:!1,isCommentLoading:!1,setTop:!1,inputValue:"",isBaseLayoutReady:!1},i.likedLoading=!1,i.collectLoading=!1,i.perPage=20,i.page=1,i.commentDataSort=!0,i.threadBodyRef=k.a.createRef(),i.commentDataRef=k.a.createRef(),i.position=0,i.comment=null,i.reportContent=["\u5e7f\u544a\u5783\u573e","\u8fdd\u89c4\u5185\u5bb9","\u6076\u610f\u704c\u6c34","\u91cd\u590d\u53d1\u5e16"],i.inputText="\u8bf7\u8f93\u5165\u5176\u4ed6\u7406\u7531",i.positionRef=k.a.createRef(),i.isPositioned=!1,i}return d()(n,[{key:"handleOnRefresh",value:function(){return this.props.thread.setCommentListPage(this.props.thread.page+1),this.loadCommentList()}},{key:"handleOnScroll",value:function(){var e,t,n,i,r=null===(e=this.threadBodyRef)||void 0===e||null===(t=e.current)||void 0===t||null===(n=t.listRef)||void 0===n||null===(i=n.current)||void 0===i?void 0:i.listWrapper;if(r&&r.current){var a,s=null===r||void 0===r||null===(a=r.current)||void 0===a?void 0:a.scrollTop;this.props.thread.setScrollDistance(s)}}},{key:"onBaseLayoutReady",value:function(){this.setState({isBaseLayoutReady:!0})}},{key:"componentDidUpdate",value:function(){var e,t,n=this;if(this.state.isBaseLayoutReady){var i,r,a,s,o=null===(i=this.threadBodyRef)||void 0===i||null===(r=i.current)||void 0===r||null===(a=r.listRef)||void 0===a||null===(s=a.current)||void 0===s?void 0:s.listWrapper;o&&this.scrollToPostion(o),this.setState({isBaseLayoutReady:!1})}null!==(e=this.props.commentPosition)&&void 0!==e&&e.postId&&!this.isPositioned&&null!==(t=this.positionRef)&&void 0!==t&&t.current&&(this.isPositioned=!0,setTimeout((function(){n.positionRef.current.scrollIntoView()}),1e3))}},{key:"componentWillUnmount",value:function(){}},{key:"scrollToPostion",value:function(e){var t;null===e||void 0===e||null===(t=e.current)||void 0===t||t.scrollTo(0,this.props.thread.scrollDistance)}},{key:"loadCommentList",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.props.thread.isCommentReady,!this.state.isCommentLoading&&i){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),r=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:r,page:this.props.thread.page,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.thread.loadCommentList(s);case 8:if(o=e.sent,c=o.success,l=o.msg,this.setState({isCommentLoading:!1}),!c){e.next=14;break}return e.abrupt("return");case 14:V.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSortChange",value:function(e){this.commentDataSort=e,this.props.thread.setCommentListPage(1),this.props.commentPosition.reset(),this.loadCommentList()}},{key:"onInputClick",value:function(){this.setState({showCommentInput:!0})}},{key:"onOperClick",value:function(e){if("stick"===e&&this.updateStick(),"essence"===e&&this.updateEssence(),"delete"===e&&this.setState({showDeletePopup:!0}),"edit"===e){var t,n,i,r;if(null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n||!n.id)return;this.props.router.push("/thread/post?id=".concat(null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id))}"report"===e&&this.setState({showReportPopup:!0})}},{key:"onReportClick",value:function(e){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.comment=e,this.setState({showReportPopup:!0})}},{key:"onReportOk",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return V.a.info({content:"\u8bf7\u9009\u62e9\u6216\u8f93\u5165\u4e3e\u62a5\u7406\u7531"}),e.abrupt("return");case 3:return n={threadId:this.props.thread.threadData.threadId,reason:t,userId:this.props.user.userInfo.id},this.comment?(n.type=2,n.postId=this.comment.id):n.type=1,e.next=7,this.props.thread.createReports(n);case 7:if(i=e.sent,r=i.success,s=i.msg,!r){e.next=14;break}return V.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),this.setState({showReportPopup:!1}),e.abrupt("return",!0);case 14:V.a.error({content:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReportCancel",value:function(){this.comment=null,this.setState({showReportPopup:!1})}},{key:"setTopState",value:function(e){var t=this;this.setState({showContent:e,setTop:!this.state.setTop}),setTimeout((function(){t.setState({setTop:!t.state.setTop})}),2e3)}},{key:"updateStick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,o={id:s,isStick:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(r=i.threadData)&&void 0!==r&&r.isStick)},e.next=4,this.props.thread.updateStick(o);case 4:if(c=e.sent,l=c.success,u=c.msg,!l){e.next=11;break}return this.setTopState(o.isStick),(null===(d=this.props)||void 0===d||null===(p=d.index)||void 0===p?void 0:p.refreshHomeData)&&this.props.index.refreshHomeData(),e.abrupt("return");case 11:V.a.error({content:u});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEssence",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,isEssence:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(r=i.threadData)&&void 0!==r&&null!==(s=r.displayTag)&&void 0!==s&&s.isEssence)},e.next=4,this.props.thread.updateEssence(c);case 4:if(l=e.sent,u=l.success,d=l.msg,this.props.thread.updateListStore(),!u){e.next=11;break}return V.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),e.abrupt("return");case 11:V.a.error({content:d});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showDeletePopup:!1}),i=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,e.next=4,this.props.thread.delete(i);case 4:if(r=e.sent,s=r.success,o=r.msg,!s){e.next=11;break}return V.a.success({content:"\u5220\u9664\u6210\u529f\uff0c\u5373\u5c06\u8df3\u8f6c\u81f3\u9996\u9875"}),setTimeout((function(){c.props.router.push("/")}),1e3),e.abrupt("return");case 11:V.a.error({content:o});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onBtnClick",value:function(){this.delete(),this.setState({showDeletePopup:!1})}},{key:"onPublishClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:"",n=i.length>1&&void 0!==i[1]?i[1]:[],this.props.user.isLogin()){e.next=6;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 6:if(t.replace(/\s/g,"")||0!==n.length){e.next=10;break}return V.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 10:if(!this.comment){e.next=16;break}return e.next=13,this.updateComment(t,n);case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,this.createComment(t,n);case 18:e.t0=e.sent;case 19:return e.abrupt("return",e.t0);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o,c,l,u,d,p,h,v,m,f,j;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id,l={id:c,content:t,sort:this.commentDataSort,isNoMore:null===(s=this.props)||void 0===s||null===(o=s.thread)||void 0===o?void 0:o.isNoMore,attachments:[]},null!==n&&void 0!==n&&n.length&&(l.attachments=n.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=5,this.props.comment.createComment(l,this.props.thread);case 5:if(u=e.sent,d=u.success,p=u.msg,h=u.isApproved,v=u.redPacketAmount,!d){e.next=19;break}return h?V.a.success({content:p}):V.a.warning({content:p}),v&&v>0&&this.props.thread.setRedPacket(v),this.props.thread.updatePostCount(this.props.thread.totalCount),this.props.thread.updateListStore(),(null===(m=this.props.thread)||void 0===m||null===(f=m.threadData)||void 0===f||null===(j=f.displayTag)||void 0===j?void 0:j.isRedPack)&&this.props.thread.fetchThreadDetail(c),this.setState({showCommentInput:!1,inputValue:""}),e.abrupt("return",!0);case 19:V.a.error({content:p});case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateComment",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.comment){e.next=2;break}return e.abrupt("return");case 2:return s=null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.id,o={id:s,postId:this.comment.id,content:t,attachments:[]},null!==n&&void 0!==n&&n.length&&(o.attachments=n.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=7,this.props.comment.updateComment(o,this.props.thread);case 7:if(c=e.sent,l=c.success,u=c.msg,d=c.isApproved,!l){e.next=15;break}return d?V.a.success({content:u}):V.a.warning({content:u}),this.setState({showCommentInput:!1}),e.abrupt("return",!0);case 15:V.a.error({content:u});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEditClick",value:function(e){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.comment=e,this.setState({inputValue:e.content,showCommentInput:!0})}},{key:"onClose",value:function(){this.setState({showCommentInput:!1}),this.comment=null}},{key:"onLikeClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:if(!this.likedLoading){e.next=6;break}return e.abrupt("return");case 6:return this.likedLoading=!0,c=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,l={id:c,pid:null===(i=this.props.thread)||void 0===i||null===(r=i.threadData)||void 0===r?void 0:r.postId,isLiked:!(null!==(s=this.props.thread)&&void 0!==s&&null!==(o=s.threadData)&&void 0!==o&&o.isLike)},e.next=11,this.props.thread.updateLiked(l,this.props.index,this.props.user);case 11:u=e.sent,d=u.success,p=u.msg,this.likedLoading=!1,d||V.a.error({content:p});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onShareClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.a.info({content:"\u590d\u5236\u94fe\u63a5\u6210\u529f"}),o=(null===(t=this.props.thread)||void 0===t?void 0:t.threadData)||{},c=o.title,l=void 0===c?"":c,Q()({title:l,path:"thread/".concat(null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.threadId)}),u=null===(r=this.props.thread)||void 0===r||null===(s=r.threadData)||void 0===s?void 0:s.id,e.next=6,this.props.thread.shareThread(u);case 6:d=e.sent,p=d.success,h=d.msg,p||V.a.error({content:h});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onCollectionClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:if(!this.collectLoading){e.next=6;break}return e.abrupt("return");case 6:return this.collectLoading=!0,r=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:r,isFavorite:!(null!==(i=this.props.thread)&&void 0!==i&&i.isFavorite)},e.next=11,this.props.thread.updateFavorite(s);case 11:o=e.sent,c=o.success,l=o.msg,this.collectLoading=!1,c||V.a.error({content:l});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onFollowClick",value:function(){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});var e,t,n,i;this.props.thread.threadData.userId&&(2===(null===(e=this.props.thread)||void 0===e||null===(t=e.authorInfo)||void 0===t?void 0:t.follow)||1===(null===(n=this.props.thread)||void 0===n||null===(i=n.authorInfo)||void 0===i?void 0:i.follow)?this.props.thread.cancelFollow({id:this.props.thread.threadData.userId,type:1},this.props.user):this.props.thread.postFollow(this.props.thread.threadData.userId,this.props.user))}},{key:"onPayClick",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(B.a)({url:"/user/login"}),e.abrupt("return");case 4:return r=this.props.thread.threadData,e.next=7,Object(Y.a)(r,null===(t=this.props.user)||void 0===t?void 0:t.userInfo);case 7:if(s=e.sent,!s.success||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId){e.next=13;break}return e.next=12,this.props.thread.fetchThreadDetail(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.threadId);case 12:this.props.thread.updateListStore();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onRewardClick",value:function(){if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});this.setState({showRewardPopup:!0})}},{key:"onRewardSubmit",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s,o,c,l,u,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(isNaN(Number(t))||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId||null===(r=this.props.thread)||void 0===r||null===(s=r.threadData)||void 0===s||!s.userId){e.next=9;break}return this.setState({showRewardPopup:!1}),l={amount:Number(t),threadId:this.props.thread.threadData.threadId,payeeId:this.props.thread.threadData.userId,title:(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.title)||"\u4e3b\u9898\u6253\u8d4f"},e.next=5,this.props.thread.rewardPay(l,this.props.user,this.props.index);case 5:u=e.sent,d=u.success,p=u.msg,d||V.a.error({content:p});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTagClick",value:function(){var e,t,n=null===(e=this.props.thread)||void 0===e||null===(t=e.threadData)||void 0===t?void 0:t.categoryId;(n||"number"===typeof n)&&this.props.index.refreshHomeData({categoryIds:[n]}),this.props.router.push("/")}},{key:"onPrivateLetter",value:function(){var e;if(!this.props.user.isLogin())return V.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(B.a)({url:"/user/login"});var t=null===(e=this.props.thread)||void 0===e?void 0:e.authorInfo,n=t.username,i=t.nickname;n&&g.a.push({url:"/message?page=chat&username=".concat(n,"&nickname=").concat(i)})}},{key:"onUserClick",value:function(e){e&&g.a.push({url:"/user/".concat(e)})}},{key:"onLoadMoreClick",value:function(){this.props.commentPosition.page=this.props.commentPosition.page+1,this.loadCommentPositionList()}},{key:"loadCommentPositionList",value:function(){var e=o()(a.a.mark((function e(){var t,n,i,r,s,o,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.props.commentPosition.isCommentReady,!this.state.isCommentLoading&&s){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,page:(null===(i=this.props)||void 0===i||null===(r=i.commentPosition)||void 0===r?void 0:r.page)||1,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.commentPosition.loadCommentList(c);case 8:if(l=e.sent,u=l.success,d=l.msg,this.setState({isCommentLoading:!1}),!u){e.next=14;break}return e.abrupt("return",!0);case 14:V.a.error({content:d});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderContent",value:function(){var e,t=this,n=this.props,r=n.thread,a=n.canPublish,s=r.isReady,o=r.isCommentReady,c=(r.isNoMore,r.totalCount,r.isCommentListError),l=1===((null===r||void 0===r||null===(e=r.threadData)||void 0===e?void 0:e.isApproved)||0),u=this.props.commentPosition,d=u.isShowCommentList,p=u.isNoMore;return Object(i.jsxs)("div",{className:Ye.a.bodyLeft,children:[s&&!l&&Object(i.jsx)("div",{className:Ye.a.examinePosition}),s?Object(i.jsx)(pt,{store:r,onOperClick:function(e){return t.onOperClick(e)},onLikeClick:function(){return t.onLikeClick()},onCollectionClick:function(){return t.onCollectionClick()},onShareClick:function(){return t.onShareClick()},onRewardClick:function(){return t.onRewardClick()},onTagClick:function(){return t.onTagClick()},onPayClick:function(){return t.onPayClick()},onUserClick:function(){var e,n,i;return t.onUserClick(null===(e=t.props.thread)||void 0===e||null===(n=e.threadData)||void 0===n||null===(i=n.user)||void 0===i?void 0:i.userId)}}):Object(i.jsx)(S.a,{type:"init"}),Object(i.jsx)("div",{className:"".concat(Ye.a.bottom),children:o&&l?Object(i.jsxs)(b.Fragment,{children:[o&&d&&Object(i.jsxs)(b.Fragment,{children:[Object(i.jsx)(yt,{commentDataRef:this.commentDataRef,isPositionComment:!0,router:this.props.router,sort:function(e){return t.onSortChange(e)},replyAvatarClick:function(e,n,i){return t.replyAvatarClick(e,n,i)}}),!p&&Object(i.jsxs)("div",{className:Ye.a.showMore,onClick:function(){return t.onLoadMoreClick()},children:[Object(i.jsx)("div",{className:Ye.a.hidePercent,children:"\u5c55\u5f00\u66f4\u591a\u8bc4\u8bba"}),Object(i.jsx)(T.a,{className:Ye.a.icon,name:"RightOutlined",size:12})]})]}),Object(i.jsx)(yt,{canPublish:a,positionRef:this.positionRef,showHeader:!d,router:this.props.router,sort:function(e){return t.onSortChange(e)},onEditClick:function(e){return t.onEditClick(e)},onPublishClick:function(e,n){return t.onPublishClick(e,n)},onReportClick:function(e){return t.onReportClick(e)}})]}):l&&Object(i.jsx)(S.a,{isError:c,type:"init"})})]})}},{key:"renderRight",value:function(){var e,t,n,r,a,s,o,c=this,l=this.props.thread,u=l.isAuthorInfoError,d=l.isReady,p=1===((null===l||void 0===l||null===(e=l.threadData)||void 0===e?void 0:e.isApproved)||0),h=(null===(t=this.props.user)||void 0===t||null===(n=t.userInfo)||void 0===n?void 0:n.id)&&(null===(r=this.props.user)||void 0===r||null===(a=r.userInfo)||void 0===a?void 0:a.id)===(null===l||void 0===l||null===(s=l.threadData)||void 0===s?void 0:s.userId),v=null===l||void 0===l||null===(o=l.threadData)||void 0===o?void 0:o.isAnonymous;return Object(i.jsxs)("div",{className:"".concat(Ye.a.bodyRigth),children:[d&&!p&&Object(i.jsx)("div",{className:Ye.a.examinePosition}),!v&&Object(i.jsx)("div",{className:"".concat(Ye.a.authorInfo," detail-authorinfo"),children:null!==l&&void 0!==l&&l.authorInfo?Object(i.jsx)(He.a,{user:l.authorInfo,onFollowClick:function(){return c.onFollowClick()},onPrivateLetter:function(){return c.onPrivateLetter()},onPersonalPage:function(){var e,t,n;return c.onUserClick(null===(e=c.props.thread)||void 0===e||null===(t=e.threadData)||void 0===t||null===(n=t.user)||void 0===n?void 0:n.userId)},isShowBtn:!h}):Object(i.jsx)(S.a,{type:"init",isError:u})}),Object(i.jsx)("div",{className:Ye.a.recommend,children:Object(i.jsx)(it.a,{})}),Object(i.jsx)("div",{className:Ye.a.qrcode,children:Object(i.jsx)(rt.a,{})}),Object(i.jsx)(ze.a,{className:Ye.a.copyright})]})}},{key:"render",value:function(){var e,t,n,r,a,s,o,c,l,u,d,p,h,v,m,f,j,b,k=this,x=this.props.thread,O=x.isCommentReady,y=x.isNoMore,C=this.props.thread,D=C.isReady,w=1===((null===C||void 0===C||null===(e=C.threadData)||void 0===e?void 0:e.isApproved)||0),g=null===C||void 0===C||null===(t=C.threadData)||void 0===t?void 0:t.isAnonymous,N=(null===(n=this.props.user)||void 0===n||null===(r=n.userInfo)||void 0===r?void 0:r.id)&&(null===(a=this.props.user)||void 0===a||null===(s=a.userInfo)||void 0===s?void 0:s.id)===(null===C||void 0===C||null===(o=C.threadData)||void 0===o?void 0:o.userId);return Object(i.jsxs)("div",{children:[Object(i.jsx)(et,{showContent:null===(c=this.props.thread)||void 0===c||null===(l=c.threadData)||void 0===l?void 0:l.isStick,setTop:this.state.setTop}),Object(i.jsx)(nt,{isShow:D&&!w}),Object(i.jsx)(Qe.a,{onRefresh:function(){return k.handleOnRefresh()},onScroll:function(){return k.handleOnScroll()},noMore:y,ref:this.threadBodyRef,showRefresh:!1,right:this.renderRight(),isShowLayoutRefresh:O,ready:function(){return k.onBaseLayoutReady()},rightClassName:I()(Ye.a.positionSticky,{"is-userinfo-show":!g,"is-operate-show":!N}),className:"detail",children:this.renderContent()}),Object(i.jsx)($.a,{position:"center",visible:this.state.showCommentInput,onClose:function(){return k.onClose()},children:Object(i.jsxs)("div",{className:Ye.a.editCmment,children:[Object(i.jsx)("div",{className:Ye.a.close,onClick:function(){return k.onClose()},children:Object(i.jsx)(T.a,{size:18,name:"WrongOutlined"})}),Object(i.jsx)("div",{className:Ye.a.title,children:"\u7f16\u8f91\u8bc4\u8bba"}),Object(i.jsx)("div",{className:Ye.a.user,children:Object(i.jsx)(be.a,{name:(null===this||void 0===this||null===(u=this.comment)||void 0===u||null===(d=u.user)||void 0===d?void 0:d.nickname)||"",avatar:(null===this||void 0===this||null===(p=this.comment)||void 0===p||null===(h=p.user)||void 0===h?void 0:h.avatar)||"",time:"".concat(null===this||void 0===this||null===(v=this.comment)||void 0===v?void 0:v.updatedAt)||"",userId:null===this||void 0===this||null===(m=this.comment)||void 0===m||null===(f=m.user)||void 0===f?void 0:f.userId,platform:"pc"})}),Object(i.jsx)(Ke.a,{height:"middle",onSubmit:function(e){return k.onPublishClick(e)},initValue:this.state.inputValue,threadId:null===(j=this.props.thread)||void 0===j||null===(b=j.threadData)||void 0===b?void 0:b.userId,isAnonymous:g})]})}),Object(i.jsx)(_.a,{visible:this.state.showDeletePopup,onClose:function(){return k.setState({showDeletePopup:!1})},onBtnClick:function(){return k.delete()},type:"thread"}),Object(i.jsx)(Ze.a,{reportContent:this.reportContent,inputText:this.inputText,visible:this.state.showReportPopup,onCancel:function(){return k.onReportCancel()},onOkClick:function(e){return k.onReportOk(e)}}),Object(i.jsx)(Je,{visible:this.state.showRewardPopup,onCancel:function(){return k.setState({showRewardPopup:!1})},onOkClick:function(e){return k.onRewardSubmit(e)}})]})}}]),n}(k.a.Component))||Ot)||Ot)||Ot)||Ot)||Ot)||Ot)||Ot,gt=Object(x.withRouter)(wt),Nt=n("ZCww"),Pt=n("L0er"),Rt=n("J0pL"),It=n("Tk/S"),St=n("/Ugf"),Lt=n("lF3x"),Tt=(n("z/8X"),n("SRSl"));function Et(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var r=j()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var At=Object(O.c)("site")(Dt=Object(O.c)("thread")(Dt=Object(O.c)("commentPosition")(Dt=Object(O.c)("user")(Dt=Object(O.c)("index")(Dt=Object(O.c)("threadList")(Dt=Object(O.d)(Dt=function(e){h()(n,e);var t=Et(n);function n(e){var i;l()(this,n),(i=t.call(this,e)).updateViewCount=function(){var e=o()(a.a.mark((function e(t){var n,r,s,o,c,l,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.props.site,s=(null===r||void 0===r||null===(n=r.webConfig)||void 0===n?void 0:n.setSite)||{},o=s.openViewCount,c=Number(o),l=Number(t),e.next=6,Object(Lt.c)(l,0===c);case 6:(u=e.sent)&&(i.props.thread.updateViewCount(u),Object(Tt.d)(l,{updateType:"viewCount",updatedInfo:{viewCount:u}}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.handleWeiXinShare=o()(a.a.mark((function e(){var t,n,r,s,o,c,l,u,d,p,h,v,m,f,j,b,k,x,O,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e){var i=Object(St.a)(e);if(i)return i.length>28?"".concat(i.substr(0,28),"..."):i}var r=[];n[101]&&r.push("\u56fe\u7247"),n[103]&&r.push("\u89c6\u9891"),n[102]&&r.push("\u8bed\u97f3"),n[108]&&r.push("\u9644\u4ef6");var a=r.length>0?"".concat(r.join("/")):"\u5185\u5bb9",s=t&&t.nickname?"".concat(t.nickname):"\u533f\u540d\u7528\u6237";return"".concat(s,"\u53d1\u5e03\u7684").concat(a)},n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r=null;if(1!==f){for(var a=t.match(/<img[\s]+[^<>]*>|<img[\s]+[^<>]*/g)||[],s=0;s<a.length;s++)if(-1===a[s].indexOf("qq-emotion")&&(r=a[s].match(/(http|https):\/\/.*?(webp|png|jpg|jpeg)/gi))){r=r?r[0]:null;break}if(2!==f&&!r&&n[101])for(var o=n[101].body||[],c=0;c<o.length;c++)if("gif"!==o[c].extension){r=o[c].thumbUrl;break}}return!j&&!r&&e&&e.avatar&&(r=e.avatar),!r&&i&&""!==i&&(r=i),r},r=i.props,s=r.site,o=r.thread,c=s.webConfig,l=c.setSite,u=l.siteHeaderLogo,d=l.siteIntroduction,p=o.threadData,h=p.content,v=p.title,m=p.user,f=p.payType,j=p.isAnonymous,b=h.text,k=h.indexes,x=d&&""!==d?d:"\u5728\u8fd9\u91cc\uff0c\u53d1\u73b0\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9",O=v&&""!==v?v:t(b,m,k),y=n(m,b,k,u),Object(It.a)(O,x,window.location.href,y)}catch(a){console.error("\u8bbe\u7f6e\u5206\u4eab\u9519\u8bef",a)}case 1:case"end":return e.stop()}}),e)}))),i.state={isServerError:!1,serverErrorMsg:""};var r=i.props,s=r.thread,c=r.serverThread;return(null===c||void 0===c?void 0:c.threadData)&&s.setThreadData(c.threadData),i}return d()(n,null,[{key:"getInitialProps",value:function(){var e=o()(a.a.mark((function e(t){var n,i,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===t||void 0===t||null===(n=t.query)||void 0===n?void 0:n.id,r={threadData:null},!i){e.next=7;break}return e.next=5,Object(y.readThreadDetail)({params:{threadId:i}},t);case 5:0===(s=e.sent).code&&(r.threadData=s.data);case 7:return e.abrupt("return",{serverThread:r});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),d()(n,[{key:"componentDidUpdate",value:function(e){var t,n,i,r,a,s;(null!==(t=this.props.router)&&void 0!==t&&null!==(n=t.query)&&void 0!==n&&n.id&&this.props.router.query.id!==e.router.query.id&&(this.props.thread.reset(),this.getPageDate(this.props.router.query.id)),null!==(i=this.props.router)&&void 0!==i&&null!==(r=i.query)&&void 0!==r&&r.postId&&this.props.router.query.postId!==e.router.query.postId)&&this.getPositionComment(null===(a=this.props.router)||void 0===a||null===(s=a.query)||void 0===s?void 0:s.id,this.props.router.query.postId)}},{key:"componentDidMount",value:function(){var e=o()(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.router.query,n=t.id,i=t.postId,!n){e.next=5;break}return e.next=4,this.getPageDate(n,i);case 4:this.updateViewCount(n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPageDate",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o,c,l,u,d,p,h,v,m,f,j,b,k,x,O,y,C,D,w,N,P,R,I,S,L;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(i=this.props)&&void 0!==i&&null!==(r=i.thread)&&void 0!==r&&r.threadData&&this.hasMaybeCache()){e.next=21;break}return h=(null===(u=this.props.thread)||void 0===u?void 0:u.isPositionToComment)||!1,this.props.thread.reset({isPositionToComment:h}),e.next=5,this.props.thread.fetchThreadDetail(t);case 5:if(0===(v=e.sent).code){e.next=13;break}if(-4004!==v.code){e.next=10;break}return g.a.replace({url:"/404"}),e.abrupt("return");case 10:return v.code>-5e3&&v.code<-4e3&&this.setState({serverErrorMsg:v.msg}),this.setState({isServerError:!0}),e.abrupt("return");case 13:if(1===((null===(d=this.props.thread)||void 0===d||null===(p=d.threadData)||void 0===p?void 0:p.isApproved)||0)){e.next=21;break}if(x=null===(m=this.props.user)||void 0===m||null===(f=m.userInfo)||void 0===f?void 0:f.id,O=null===(j=this.props.thread)||void 0===j||null===(b=j.threadData)||void 0===b||null===(k=b.user)||void 0===k?void 0:k.userId,x&&O&&x===O){e.next=21;break}return V.a.info({content:"\u5185\u5bb9\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\u624d\u80fd\u6b63\u5e38\u663e\u793a!"}),g.a.redirect({url:"/"}),e.abrupt("return");case 21:return this.hasMaybeCache()&&(1===((null===(y=this.props.thread)||void 0===y||null===(C=y.threadData)||void 0===C?void 0:C.isApproved)||0)||this.getThreadDataFromList(t)),Object(ce.a)()&&this.handleWeiXinShare(),e.next=25,this.getPositionComment(t,n);case 25:null!==(s=this.props)&&void 0!==s&&null!==(o=s.thread)&&void 0!==o&&o.commentList&&this.hasMaybeCache()&&!n||(this.props.thread.setCommentListPage((null===(D=this.props.commentPosition)||void 0===D?void 0:D.postsPositionPage)||1),w={id:t,page:this.props.thread.page},this.props.thread.loadCommentList(w)),null!==(c=this.props)&&void 0!==c&&null!==(l=c.thread)&&void 0!==l&&l.authorInfo&&this.hasMaybeCache()||(I=this.props.site,S=I.platform,L=null===(N=this.props.thread)||void 0===N||null===(P=N.threadData)||void 0===P||null===(R=P.user)||void 0===R?void 0:R.userId,"pc"===S&&L&&this.props.thread.fetchAuthorInfo(L)),this.props.thread.queryTipList({threadId:t,postId:n,type:2,page:1});case 28:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getThreadDataFromList",value:function(){var e=o()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&null!==(n=this.props.threadList.findAssignThreadInLists({threadId:Number(t)}))&&void 0!==n&&n.length&&n.forEach((function(e){e.data&&(e=e.data)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPositionComment",value:function(){var e=o()(a.a.mark((function e(t,n){var i,r,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||null===(i=this.props)||void 0===i||null===(r=i.commentPosition)||void 0===r||r.reset(),!t||!n){e.next=7;break}return this.props.commentPosition.setPostId(Number(n)),s={threadId:t,postId:n,pageSize:20},e.next=6,this.props.commentPosition.fetchPositionPosts(s);case 6:this.props.commentPosition.isShowCommentList&&(o={id:t},this.props.commentPosition.loadCommentList(o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"hasMaybeCache",value:function(){var e,t,n,i=this.props.router.query.id,r=null===(e=this.props)||void 0===e||null===(t=e.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.threadId;return i&&r&&Number(i)===r}},{key:"render",value:function(){var e,t,n,r,a,s,o,c,l,u=this.props,d=u.site,p=u.canPublish,h=d.platform,v=!0;return(null!==(e=this.props)&&void 0!==e&&null!==(t=e.thread)&&void 0!==t&&null!==(n=t.threadData)&&void 0!==n&&n.title||null!==(r=this.props)&&void 0!==r&&null!==(a=r.thread)&&void 0!==a&&null!==(s=a.threadData)&&void 0!==s&&null!==(o=s.content)&&void 0!==o&&o.text)&&(v=!1),this.state.isServerError?"h5"===h?Object(i.jsx)(Pt.a,{text:this.state.serverErrorMsg}):Object(i.jsx)(Nt.a,{text:this.state.serverErrorMsg}):Object(i.jsx)(Rt.a,{h5:Object(i.jsx)(Ge,{}),pc:Object(i.jsx)(gt,{canPublish:p}),title:(null===(c=this.props)||void 0===c||null===(l=c.thread)||void 0===l?void 0:l.title)||"",showSiteName:v})}}]),n}(k.a.Component))||Dt)||Dt)||Dt)||Dt)||Dt)||Dt)||Dt;t.default=Object(x.withRouter)(Object(Be.a)(At))},ZCww:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("nKUr"),r=n("q1tI"),a=n("6csX"),s=n("5f2u"),o=n.n(s),c=n("z8Av"),l=n("wXCO");function u(e){var t=Object(r.useState)(e.text||"\u670d\u52a1\u5668\u9519\u8bef SERVER ERROR")[0];return Object(i.jsxs)("div",{className:a.a.page,children:[Object(i.jsx)(c.a,{}),Object(i.jsxs)("div",{className:a.a.body,children:[Object(i.jsx)("img",{className:a.a.icon,src:"/dzq-img/error.png"}),Object(i.jsx)("span",{className:a.a.text,children:t}),Object(i.jsx)(o.a,{onClick:function(){window.location.reload()},className:a.a.button,type:"primary",children:"\u70b9\u6211\u5237\u65b0"})]}),Object(i.jsx)("div",{className:a.a.footer,children:Object(i.jsx)(l.a,{})})]})}},c7hV:function(e,t,n){"use strict";var i=n("nKUr"),r=n("q1tI"),a=n("MCNy"),s=n.n(a),o=n("k8W2"),c=n.n(o),l=n("5f2u"),u=n.n(l),d=n("ZS9c"),p=n("TSYQ"),h=n.n(p);t.a=function(e){var t=e.visible,n=e.onSubmit,a=e.onClose,o=e.onOperClick,l=e.permissions,p=void 0===l?{}:l,v=e.statuses,m=void 0===v?{}:v,f=p.canEdit,j=p.canDelete,b=p.canEssence,k=p.canStick,x=p.canShare,O=p.canWxShare,y=p.canCollect,C=p.isAdmini,D=m.isEssence,w=m.isStick,g=m.isCollect,N=Object(r.useState)(D),P=N[0],R=N[1],I=Object(r.useState)(w),S=I[0],L=I[1],T=Object(r.useState)(g),E=T[0],A=T[1],M=Object(r.useMemo)((function(){return 1+f+j+b+k+x+y}),[f,j,b,k,x,y]);return Object(r.useEffect)((function(){R(D)}),[D]),Object(r.useEffect)((function(){L(w)}),[w]),Object(r.useEffect)((function(){A(g)}),[g]),Object(i.jsx)(c.a,{position:"bottom",visible:t,onClose:a,children:Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{className:d.a.container,children:Object(i.jsxs)("div",{className:h()(d.a.more,M<5&&d.a.flex),children:[f&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("edit")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"RedactOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u7f16\u8f91"})]}),j&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("delete")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"DeleteOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u5220\u9664"})]}),b&&Object(i.jsxs)("div",{className:h()(d.a.moreItem,P&&d.a.actived),onClick:function(){return o("essence")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"HotBigOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u7cbe\u534e"})]}),k&&Object(i.jsxs)("div",{className:h()(d.a.moreItem,S&&d.a.actived),onClick:function(){return o("stick")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"TopOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u7f6e\u9876"})]}),y&&Object(i.jsxs)("div",{className:h()(d.a.moreItem,E&&d.a.actived),onClick:function(){return o("collect")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"CollectFunOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u6536\u85cf"})]}),x&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("post")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"PictureOutlinedBig",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u751f\u6210\u6d77\u62a5"})]}),x&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("copylink")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"PaperClipOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u590d\u5236\u94fe\u63a5"})]}),O&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("wxshare")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"WeChatOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u5fae\u4fe1\u5206\u4eab"})]}),!C&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("report")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"WarnOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u4e3e\u62a5"})]})]})}),Object(i.jsx)("div",{className:d.a.button,children:Object(i.jsx)(u.a,{full:!0,onClick:n,className:d.a.cancel,type:"default",children:"\u53d6\u6d88"})})]})})}},tuZy:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/thread/[id]",function(){return n("TP+V")}])},woGs:function(e,t,n){"use strict";n("2B1R"),n("qePV");var i=n("nKUr"),r=n("o0o1"),a=n.n(r),s=(n("ls82"),n("yXPU")),o=n.n(s),c=n("q1tI"),l=n("wdT/"),u=n.n(l),d=n("k8W2"),p=n.n(d),h=n("5f2u"),v=n.n(h),m=n("7O/2"),f=n.n(m),j=n("BGqZ"),b=n.n(j),k=n("qtPy");t.a=function(e){var t=e.visible,n=e.onOkClick,r=e.onCancel,s=e.inputText,l=e.reportContent,d=void 0===l?[]:l,h=Object(c.useState)(""),m=h[0],j=h[1],x=Object(c.useState)(!1),O=x[0],y=x[1],C=function(){var e=o()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(m.length>450)){e.next=3;break}return u.a.error({content:"\u4e3e\u62a5\u5185\u5bb9\u4e0d\u80fd\u5927\u4e8e450\u4e2a\u5b57\u7b26"}),e.abrupt("return");case 3:if("function"!==typeof n){e.next=14;break}return e.prev=4,e.next=7,n(m);case 7:e.sent&&j(""),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(p.a,{position:"bottom",visible:t,onClose:r,children:Object(i.jsxs)("div",{className:k.a.container,children:[Object(i.jsxs)("div",{className:k.a.header,children:[Object(i.jsx)("div",{className:k.a.title,children:"\u4e3e\u62a5"}),Object(i.jsx)("div",{className:k.a.reason,children:"\u8bf7\u9009\u62e9\u4e3e\u62a5\u7406\u7531"})]}),Object(i.jsxs)("div",{className:k.a.body,children:[Object(i.jsxs)(b.a.Group,{defaultValue:"5",onChange:function(e){return function(e){"other"===e?(y(!0),j("")):(y(!1),j(d[Number(e)]))}(e)},children:[d.map((function(e,t){return Object(i.jsxs)("div",{className:k.a.reportTitle,children:[Object(i.jsx)("div",{className:k.a.content,children:e}),Object(i.jsx)(b.a,{name:"".concat(t)})]},t)})),Object(i.jsxs)("div",{className:k.a.reportTitle,children:[Object(i.jsx)("div",{className:k.a.content,children:"\u5176\u4ed6"}),Object(i.jsx)(b.a,{name:"other"})]})]}),O?Object(i.jsx)("div",{className:k.a.textarea,children:Object(i.jsx)(f.a,{className:k.a.input,rows:5,showLimit:!0,value:m,onChange:function(e){return j(e.target.value)},placeholder:s})}):""]}),Object(i.jsxs)("div",{className:k.a.button,children:[Object(i.jsx)(v.a,{onClick:r,className:k.a.cancel,children:"\u53d6\u6d88"}),Object(i.jsx)(v.a,{onClick:C,className:k.a.ok,type:"primary",children:"\u786e\u5b9a"})]})]})})}}},[["tuZy",1,0,3,5,4,6,8,2]]]);